(()=>{"use strict";var e={8320:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.performLocalization=void 0,t.performLocalization=function(){const e=document.getElementById("analyze"),t=document.getElementById("convert"),n=document.getElementById("resetLink"),o=document.getElementById("chartInfoHeading"),i=document.getElementById("howtoHeading"),r=document.getElementById("description"),a=document.getElementById("bookmarklet"),c=document.getElementById("sampleInputs"),s=document.getElementsByClassName("totalNoteCount")[0];navigator.language.startsWith("zh")?(document.title="譜面資訊",i.innerText="使用方式",o.innerText="譜面資訊",a.innerText="換算 maimai DX 成績為舊版分數",e.innerText="分析",t.innerText="換算成舊版分數",c.innerText="範例輸入",s.innerText="總計",n.innerText="重新輸入",r.innerText=`\n使用方式一：自動代入成績\n1. 把網頁下方的連結加入書籤\n2. 登入 maimai DX NET，打開一個最近打過的歌曲成績\n3. 使用書籤\n4. 點擊「點我分析分數」\n5. 分數資料會自動匯入\n\n使用方式二：手動貼上成績 (僅限電腦版)\n1. 登入 maimai DX net，打開一個最近打過的歌曲成績\n2. 全選並用 Ctrl+C 複製\n3. 貼到上面的文字欄。\n4. 按下「${t.innerText}」或「${e.innerText}」\n`):r.innerText=`\nMethod 1: automatic import\n1. Create a bookmarklet from the link below.\n2. Log in to maimai DX NET, and open a recently played song score page.\n3. Use the bookmarklet. (Accept pop-up window if being asked.)\n4. This page shall open with score data imported.\n\nMethod 2: manually paste score\n1. Log in to maimai DX NET, and open a recently played song score page.\n2. Select all and copy with Ctrl-C.\n3. Paste the content into the text area at the top of this page.\n4. Click "${t.innerText}" or "${e.innerText}".\n`}},6991:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function c(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.removeScrollControl=t.getEpochTimeFromText=t.fetchGameVersion=t.fetchPage=void 0;const o="MaiToolsGameVer",i="MaiToolsGameVerExpire",r=6e4*((new Date).getTimezoneOffset()+540);function a(e){return n(this,void 0,void 0,(function*(){const t=yield fetch(e),n=yield t.text();return(new DOMParser).parseFromString(n,"text/html")}))}t.fetchPage=a,t.fetchGameVersion=function e(t){return n(this,void 0,void 0,(function*(){const n=parseInt(window.localStorage.getItem(i));if(!isNaN(n)&&n>=Date.now())return parseInt(window.localStorage.getItem(o));const r=t.querySelector("select[name=version] option:last-of-type");if(r instanceof HTMLOptionElement){const e=parseInt(r.value);return window.localStorage.setItem(o,String(e)),window.localStorage.setItem(i,String(Date.now()+864e5)),e}return e(t=yield a("/maimai-mobile/record/musicVersion/"))}))},t.getEpochTimeFromText=function(e){const t=e.match(/(\d+)\/(\d+)\/(\d+) (\d+):(\d+)/);return new Date(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3]),parseInt(t[4]),parseInt(t[5])).getTime()-r},t.removeScrollControl=function(e){let t=e.getElementById("page-top");t&&t.remove(),t=e.getElementById("page-bottom"),t&&t.remove()}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(()=>{const e=n(6991),t=n(8320);!function(){(0,t.performLocalization)();const n={tap:500,hold:1e3,touch:500,slide:1500,break:2500},o=["tap","hold","slide","break"],i=["tap","hold","slide","touch","break"],r=document.querySelector(".input"),a=document.getElementById("analyze"),c=document.getElementById("convert"),s=[0,0,0,0,0];function l(e){return e.trim().replace(/\s+/g,"-")}function d(e,t){const n=e.match(/\d+/g);return n?n.map((e=>parseInt(e,10))):t}function m(t,n){const o=r.value.split("\n");if(!(o.length<6)){for(;o.length;){const t=o.pop();if(t.includes("✦"))continue;if(!n.has("nd")){const e=t.match(/\d+/g);if(e&&e.length>=4&&e.length<=5){let e=l(t);for(let t=0;t<i.length-1;t++)e=l(o.pop())+"_"+e;n.set("nd",e);continue}}const r=t.match(/(\d+\.\d+)%/);if(r){n.set("ac",r[1]),n.set("st",o.pop());continue}const a=t.indexOf("TRACK 0");a>=0&&(n.set("tk","TRACK "+t.substring(a+7,a+8)),n.set("dt",String((0,e.getEpochTimeFromText)(t))))}if(n.has("st")&&n.has("ac")&&n.has("nd")){const e=t+"?"+n;console.log(e),window.location.assign(e)}}}a.addEventListener("click",(()=>{m(document.location.origin+document.location.pathname,new URLSearchParams)})),c.addEventListener("click",(()=>{m("../classic-layout/",new URLSearchParams({gameVersion:"10"}))}));const u=new URLSearchParams(document.location.search);let p=!0;const h=u.get("st"),g=u.get("nd");h&&g&&(document.title=`${h} - ${document.title}`,function(e,t){if(t.length>=4){const r=document.getElementById("songTitle");r.innerText=e||"",r.href="https://maimai.fandom.com/zh/wiki/"+encodeURIComponent(e)+"?variant=zh-hant";const a=4===t.length?o:i,c=new Map;t.forEach(((e,t)=>{c.set(a[t],e)}));const s={tap:0,hold:0,slide:0,touch:0,break:0},l=i.reduce(((e,t)=>{const n=(c.get(t)||[]).reduce(((e,t)=>e+t),0);return s[t]=n,"touch"===t&&document.querySelector(".touchRow").classList[0===n?"add":"remove"]("hidden"),document.getElementById(`${t}Count`).innerText=n.toString(),e+n}),0);document.getElementById("totalNoteCount").innerText=l.toString();const[d,m]=function(e){let t=0;for(const o of i)e[o]&&(t+=e[o]*n[o]);const o=new Map,r=5e4/t,a=1/e.break;o.set("tap",r),o.set("hold",2*r),o.set("slide",3*r),o.set("touch",r),o.set("breakDx",5*r+a),o.set("break",5.2*r);let c=1e4*e.break/t;return c=Math.floor(100*c)/100,c+=100,[o,c]}(s);d.forEach(((e,t)=>{let n;switch(t=t.charAt(0).toUpperCase()+t.substring(1)){case"Break":n=document.getElementById("finalePctPerBreak"),n.innerText+=e.toFixed(2);break;case"BreakDx":n=document.getElementById("dxPctPerBreak"),n.innerText=e.toFixed(4);break;default:n=document.getElementById("pctPer"+t),n.innerText=e.toFixed(2)}n.innerText+="%"})),document.getElementById("finaleMaxAchv").innerText=m.toFixed(2)+"%"}}(h,function(e){let t=e.split("_");t.length<5&&(t=e.split("\n"));const n=d(t.pop(),void 0),o=s.slice(0,n.length),i=d(t.pop(),void 0),r=d(t.pop(),o),a=d(t.pop(),o),c=[d(t.pop(),o),a,r,n];return i&&c.splice(3,0,i),c}(g)),p=!1),document.getElementById("resetLink").classList[p?"add":"remove"]("hidden"),document.getElementById("inputContainer").classList[p?"remove":"add"]("hidden")}()})()})();