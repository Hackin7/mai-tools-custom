(()=>{"use strict";var e={8642:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDifficultyName=t.DIFFICULTY_CLASSNAME_MAP=t.DIFFICULTIES=void 0,t.DIFFICULTIES=["BASIC","ADVANCED","EXPERT","MASTER","Re:MASTER"],t.DIFFICULTY_CLASSNAME_MAP=new Map([["Re:MASTER","remaster"],["MASTER","master"],["EXPERT","expert"],["ADVANCED","advanced"]]),t.getDifficultyName=function(e){return t.DIFFICULTIES[e]}},271:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculateDetailedDxStar=t.getDxStarText=t.determineDxStar=void 0;const n=[0,.85,.9,.93,.95,.97,.99,1];function a(e){for(let t=n.length-1;t>0;t--)if(e>=n[t])return t;return 0}t.determineDxStar=a,t.getDxStarText=function(e,t=!1){return t||e?`✦${e}`:""},t.calculateDetailedDxStar=function(e){const t=e.querySelector(".playlog_result_innerblock .playlog_score_block");if(!t)return 0;const n=t.querySelector(".w_80");if(!n)return;n.remove();const[o,r]=t.textContent.split("/").map((e=>parseInt(e.replace(",","").trim()))),c=o/r,s=a(c),l=`✦${s} (${(100*c).toFixed(1)}%)`,i=document.createElement("div");return i.className="white p_r_5 f_15 f_l",i.append(l),t.prepend(i),s}},8080:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialLanguage=t.saveLanguage=t.SUPPORTED_LANGUAGES=void 0,t.SUPPORTED_LANGUAGES=["en_US","zh_TW","ko_KR"];const n="MaiToolsLang";t.saveLanguage=function(e){window.localStorage.setItem(n,e)},t.getInitialLanguage=function(){const e=new URLSearchParams(location.search).get("hl");if(e)return e.startsWith("zh")?"zh_TW":e.startsWith("ko")?"ko_KR":"en_US";return function(){switch(window.localStorage.getItem(n)){case"en_US":return"en_US";case"zh_TW":return"zh_TW";case"ko_KR":return"ko_KR"}return null}()||(navigator.language.startsWith("zh")?"zh_TW":navigator.language.startsWith("ko")?"ko_KR":"en_US")}},6991:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeScrollControl=void 0,t.removeScrollControl=function(e){let t=e.getElementById("page-top");t&&t.remove(),t=e.getElementById("page-bottom"),t&&t.remove()}},4313:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getScriptHost=void 0,t.getScriptHost=function(e){const t=Array.from(document.querySelectorAll("script"));for(;t.length;){const n=t.pop();if(n.src.includes(e)){const e=new URL(n.src),t=e.pathname;return e.origin+t.substring(0,t.lastIndexOf("/scripts"))}}return"https://myjian.github.io/mai-tools"}},396:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function c(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(8642),r=n(271),c=n(8080),s=n(6991),l=n(4313);!function(e){const t={zh_TW:{date:"日期",songName:"歌曲",difficulty:"難度",achievement:"達成率",stamps:"成就",playDate:"遊玩日期：",newRecordToggleHeading:"顯示：",sortBy:"排序方式：",newRecordsOnly:"只顯示新高分紀錄",allRecords:"全部",olderFirst:"由舊到新",newerFirst:"由新到舊",copy:"複製",copied:"已複製到剪貼簿",downloadAsImage:"存成圖片"},en_US:{date:"Date",songName:"Song",difficulty:"Difficulty",achievement:"Achv",stamps:"Grade",playDate:"Play date:",newRecordToggleHeading:"Display:",sortBy:"Sort by:",newRecordsOnly:"New records only",allRecords:"All",olderFirst:"Older first",newerFirst:"Newer first",copy:"Copy",copied:"Copied to clipboard",downloadAsImage:"Save as image"},ko_KR:{date:"날짜",songName:"노래",difficulty:"난이도",achievement:"정확도",stamps:"등급",playDate:"플레이 일:",newRecordToggleHeading:"표시:",sortBy:"정렬 순서:",newRecordsOnly:"새 기록만",allRecords:"전부",olderFirst:"옛날 기록부터",newerFirst:"최근 기록부터",copy:"복사",copied:"클립보드에 복사되었습니다",downloadAsImage:"이미지로 저장하기"}}[(0,c.getInitialLanguage)()],n=new Map([["fc","FC"],["fcplus","FC+"],["ap","AP"],["applus","AP+"]]),i=new Map([["fs","FS"],["fsplus","FS+"],["fsd","FSD"],["fsdplus","FSD+"]]),d="newRecordRadio",p="sortByRadio",u="recordRow",m=["dateCell","songTitleCell","difficultyCell","achievementCell","stampsCell"],f=(0,l.getScriptHost)("recent-play-downloader"),g=e.createElement.bind(e),y=6e4*(540+(new Date).getTimezoneOffset());function _(e,t){return t=t||2,e.toString().padStart(t,"0")}function h(e){const t=e.querySelector(".sub_title").children[1].innerText.match(/(\d+)\/(\d+)\/(\d+) (\d+):(\d+)/),n=new Date(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3]),parseInt(t[4]),parseInt(t[5]));return new Date(n.valueOf()-y)}function v(e){try{return e.querySelector(".m_5.p_5.f_13").textContent}catch(t){return console.log(t),console.log(e),""}}function S(e){const t=e.querySelector(".music_img");return t?t.src:""}function w(e){const t=e.children[1].className;let n=t.substring(t.indexOf("_")+1,t.lastIndexOf("_"));return n="remaster"===n?"Re:MASTER":n.toUpperCase(),e.querySelector(".playlog_music_kind_icon").src.endsWith("music_dx.png")?"DX "+n:n}function b(e){return parseFloat(e.querySelector(".playlog_achievement_txt").innerText)}function I(e){const t=e.querySelector("img.playlog_scorerank").src.replace(/\?ver=.*$/,"");let a=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")).replace("plus","+").toUpperCase();const o=e.querySelectorAll(".playlog_result_innerblock > img"),c=o[0].src.replace(/\?ver=.*$/,""),s=c.substring(c.lastIndexOf("/")+1,c.lastIndexOf("."));n.has(s)&&(a+=" / "+n.get(s));const l=o[1].src.replace(/\?ver=.*$/,""),d=l.substring(l.lastIndexOf("/")+1,l.lastIndexOf("."));i.has(d)&&(a+=" / "+i.get(d));const p=function(e){const t=(0,r.calculateDetailedDxStar)(e);return(0,r.getDxStarText)(t)}(e);return p&&(a+=" / "+p),a}function E(e){return!!e.querySelector(".playlog_achievement_label_block + img.playlog_achievement_newrecord")}function R(e){return e.getFullYear()+"-"+_(e.getMonth()+1)+"-"+_(e.getDate())+" "+_(e.getHours())+":"+_(e.getMinutes())}function x(e,t,n){const a=g("tr");for(const e of t)a.classList.add(e);return e.forEach(((e,t)=>{const o=g(n?"th":"td");"string"==typeof e?o.append(e):(e[1]&&(o.classList.add("songImg"),o.style.backgroundImage=`url("${e[1]}")`),o.append(e[0])),o.classList.add("recordCell"),o.classList.add(m[t]),a.append(o)})),a}function N(e,n,a,r){a.innerHTML="",r.innerHTML="",a.append(x([t.date,t.songName,t.difficulty,t.achievement,t.stamps],[u],!0)),e.forEach((e=>{r.append(function(e){const t=e.difficulty.split(" ").pop();return x([R(e.date),[e.songName,e.songImgSrc],e.difficulty,e.achievement.toFixed(4)+"%",e.stamps],[u,o.DIFFICULTY_CLASSNAME_MAP.get(t)],!1)}(e))})),n.style.paddingBottom=Math.floor(e.length/2)+2+"px"}function A(){const t=e.querySelectorAll("input.dateCheckbox"),n=new Set;return t.forEach((e=>{e.checked&&n.add(e.value)})),n}function T(e,t){let n=[].concat(e);if(console.log(t),t.dates&&(n=n.filter((e=>t.dates.has(R(e.date).split(" ")[0])))),!t.showAll){const e=new Map;n.forEach((t=>{if(t.isNewRecord){const n=t.difficulty+" "+t.songName;e.delete(n),e.set(n,t)}})),n=[],e.forEach((e=>{n.push(e)}))}return t.olderFirst||n.reverse(),n}function C(n,a){const o=n.reduce(((e,t)=>(e.add(R(t.date).split(" ")[0]),e)),new Set);let r=e.getElementById("recordSummary");r?r.innerHTML="":(r=g("div"),r.id="recordSummary");const c=g("div");c.className="playRecordContainer";const s=g("table"),l=g("thead"),i=g("tbody");s.className="playRecordTable",s.append(l,i),c.append(s);const u=()=>{N(T(n,function(){const t=A();let n=!1;e.getElementsByName(d).forEach((e=>{e.checked&&(n="allRecords"===e.value)}));let a=!0;return e.getElementsByName(p).forEach((e=>{e.checked&&(a="olderFirst"===e.value)})),{dates:t,showAll:n,olderFirst:a}}()),c,l,i)};r.append(function(e,n){const a=g("div");a.className="m_b_10 dateOptionsContainer";const o=g("div");return o.className="t_c m_5",o.append(t.playDate),a.append(o),e.forEach((e=>{const t=g("label");t.className="f_14 dateOptionLabel";const o=g("input");o.type="checkbox",o.className="dateCheckbox",o.value=e,o.checked=!0,o.addEventListener("change",n),t.append(o,e),a.append(t)})),a}(o,u)),r.append(function(e){const n=g("div");n.className="m_b_10 newRecordToggleContainer";const a=g("div");return a.className="t_c m_5",a.append(t.newRecordToggleHeading),n.append(a),["newRecordsOnly","allRecords"].forEach(((a,o)=>{const r=g("label");r.className="f_14 newRecordLabel";const c=g("input");c.type="radio",c.name=d,c.className=d,c.value=a,c.checked=0===o,c.addEventListener("change",e),r.append(c,t[a]),n.append(r)})),n}(u)),r.append(function(e){const n=g("div");n.className="m_b_10 sortByRadioContainer";const a=g("div");return a.className="t_c m_5",a.append(t.sortBy),n.append(a),["newerFirst","olderFirst"].forEach(((a,o)=>{const r=g("label");r.className="f_14 sortByLabel";const c=g("input");c.type="radio",c.name=p,c.className=p,c.value=a,c.checked=0===o,c.addEventListener("change",e),r.append(c,t[a]),n.append(r)})),n}(u));const m=function(n){const a=g("div");a.className="copyBtnContainer";const o=g("button");o.className="copyBtn",o.append(t.copy),a.append(o);let r=e.querySelector(".snackbarContainer"),c=e.querySelector(".snackbar");r||(r=g("div"),r.className="snackbarContainer",r.style.display="none",e.body.append(r)),c||(c=g("div"),c.className="wrapper snackbar",c.innerText=t.copied,r.append(c)),o.addEventListener("click",(t=>{(()=>{const t=window.getSelection(),n=e.createRange();n.selectNodeContents(i),t.removeAllRanges(),t.addRange(n)})(),e.execCommand("copy"),r.style.display="block",c.style.opacity="1",setTimeout((()=>{c.style.opacity="0",setTimeout((()=>{r.style.display="none"}),500)}),4e3)}));const s=g("button");return s.className="downloadImgBtn",s.append(t.downloadAsImage),s.addEventListener("click",(()=>{if(!domtoimage)return void console.warn("domtoimage not available");const t=e.querySelector(".playRecordContainer");domtoimage.toPng(t).then((e=>{const t="record_"+Array.from(A()).join(",")+".png",n=g("a");n.href=e,n.download=t,n.click()}))})),a.append(s),a}();r.append(m),N(T(n,{olderFirst:!1}),c,l,i),r.append(c),a.insertAdjacentElement("beforebegin",r)}const D=e.querySelector(".main_wrapper > img.title");if(D){const t="recentPlayStyles";if(!e.getElementById(t)){const n=g("link");n.id=t,n.rel="stylesheet",n.href=f+"/scripts/recent-play-downloader.css",n.addEventListener("load",(()=>{(0,s.removeScrollControl)(e),function(){return a(this,void 0,void 0,(function*(){const t=Array.from(e.querySelectorAll(".main_wrapper .p_10.t_l.f_0.v_b")),n=[];for(const e of t)n.push({date:h(e),songName:v(e),songImgSrc:S(e),difficulty:w(e),achievement:b(e),stamps:I(e),isNewRecord:E(e)});return n.reverse(),n}))}().then((e=>{C(e,D)})).catch((t=>{const n=e.getElementsByTagName("footer")[0],a=g("textarea");n.append(a),a.value=t.message+"\n"+t.stack}))})),e.head.append(n)}const n="d2i";if(!e.getElementById(n)){const t=g("script");t.id=n,t.type="text/javascript",t.src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js",e.body.append(t)}}}(document)}},t={};!function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}(396)})();