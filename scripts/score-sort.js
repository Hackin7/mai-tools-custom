/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./scripts/score-sort.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./js/common/constants.ts":
/*!********************************!*\
  !*** ./js/common/constants.ts ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.DX_SPLASH_GAME_VERSION = exports.DX_PLUS_GAME_VERSION = exports.DX_GAME_VERSION = exports.SSSPLUS_MIN_ACHIEVEMENT = exports.DIFFICULTY_CLASSNAME_MAP = exports.DIFFICULTIES = void 0;\r\nexports.DIFFICULTIES = [\r\n    \"BASIC\", \"ADVANCED\", \"EXPERT\", \"MASTER\", \"Re:MASTER\"\r\n];\r\nexports.DIFFICULTY_CLASSNAME_MAP = new Map([\r\n    [\"Re:MASTER\", \"remaster\"],\r\n    [\"MASTER\", \"master\"],\r\n    [\"EXPERT\", \"expert\"],\r\n    [\"ADVANCED\", \"advanced\"],\r\n]);\r\nexports.SSSPLUS_MIN_ACHIEVEMENT = 100.5;\r\nexports.DX_GAME_VERSION = 13;\r\nexports.DX_PLUS_GAME_VERSION = 14;\r\nexports.DX_SPLASH_GAME_VERSION = 15;\r\n\n\n//# sourceURL=webpack:///./js/common/constants.ts?");

/***/ }),

/***/ "./js/common/fetch-score-util.ts":
/*!***************************************!*\
  !*** ./js/common/fetch-score-util.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.fetchPlayerGrade = exports.getPlayerName = exports.getChartType = exports.getChartDifficulty = exports.getChartLevel = exports.getSongName = void 0;\r\nfunction getSongName(row) {\r\n    return row.getElementsByClassName(\"music_name_block\")[0].innerText;\r\n}\r\nexports.getSongName = getSongName;\r\nfunction getChartLevel(row) {\r\n    return row.getElementsByClassName(\"music_lv_block\")[0].innerText;\r\n}\r\nexports.getChartLevel = getChartLevel;\r\nfunction getChartDifficulty(row) {\r\n    if (!row.classList.contains(\"pointer\")) {\r\n        row = row.querySelector(\".pointer\");\r\n    }\r\n    const d = row.className.match(/music_([a-z]+)_score_back/)[1].toUpperCase();\r\n    return d.indexOf(\"RE\") === 0 ? \"Re:MASTER\" : d;\r\n}\r\nexports.getChartDifficulty = getChartDifficulty;\r\nfunction getChartType(row) {\r\n    if (row.id) {\r\n        return row.id.includes(\"sta_\") ? 0 /* STANDARD */ : 1 /* DX */;\r\n    }\r\n    return row.querySelector(\"img:nth-child(2)\").src.includes(\"_standard\")\r\n        ? 0 /* STANDARD */\r\n        : 1 /* DX */;\r\n}\r\nexports.getChartType = getChartType;\r\nfunction getPlayerName(n) {\r\n    var _a;\r\n    return (_a = n.querySelector(\".name_block\")) === null || _a === void 0 ? void 0 : _a.innerText;\r\n}\r\nexports.getPlayerName = getPlayerName;\r\nfunction fetchPlayerGrade(n) {\r\n    const gradeImg = n.querySelector(\".user_data_block_line ~ img.h_25\");\r\n    if (gradeImg) {\r\n        const gradeIdx = gradeImg.src.lastIndexOf(\"grade_\");\r\n        return gradeImg.src.substring(gradeIdx + 6, gradeIdx + 8);\r\n    }\r\n    return null;\r\n}\r\nexports.fetchPlayerGrade = fetchPlayerGrade;\r\n\n\n//# sourceURL=webpack:///./js/common/fetch-score-util.ts?");

/***/ }),

/***/ "./js/common/fetch-self-score.ts":
/*!***************************************!*\
  !*** ./js/common/fetch-self-score.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.fetchScores = exports.SELF_SCORE_URLS = void 0;\r\nconst fetch_score_util_1 = __webpack_require__(/*! ./fetch-score-util */ \"./js/common/fetch-score-util.ts\");\r\nconst util_1 = __webpack_require__(/*! ./util */ \"./js/common/util.ts\");\r\nexports.SELF_SCORE_URLS = new Map([\r\n    [\"Re:MASTER\", \"/maimai-mobile/record/musicGenre/search/?genre=99&diff=4\"],\r\n    [\"MASTER\", \"/maimai-mobile/record/musicGenre/search/?genre=99&diff=3\"],\r\n    [\"EXPERT\", \"/maimai-mobile/record/musicGenre/search/?genre=99&diff=2\"],\r\n    [\"ADVANCED\", \"/maimai-mobile/record/musicGenre/search/?genre=99&diff=1\"],\r\n]);\r\nfunction getAchievement(row) {\r\n    const ach = row.querySelector(\".music_score_block.w_120\");\r\n    return ach && ach.innerText;\r\n}\r\nfunction processRow(row, difficulty, state) {\r\n    const isGenreRow = row.classList.contains(\"screw_block\");\r\n    const isScoreRow = row.classList.contains(\"w_450\") &&\r\n        row.classList.contains(\"m_15\") &&\r\n        row.classList.contains(\"p_r\") &&\r\n        row.classList.contains(\"f_0\");\r\n    if (isGenreRow) {\r\n        state.genre = row.innerText;\r\n    }\r\n    else if (isScoreRow) {\r\n        const songName = fetch_score_util_1.getSongName(row);\r\n        const level = fetch_score_util_1.getChartLevel(row);\r\n        const chartType = fetch_score_util_1.getChartType(row) === 1 /* DX */ ? \"DX\" : \"STANDARD\";\r\n        const achievement = getAchievement(row);\r\n        if (!achievement) {\r\n            return;\r\n        }\r\n        state.scoreList.push([songName, state.genre, difficulty, level, chartType, achievement].join(\"\\t\"));\r\n    }\r\n}\r\nfunction fetchScores(difficulty, scoreList) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const url = exports.SELF_SCORE_URLS.get(difficulty);\r\n        if (!url) {\r\n            return;\r\n        }\r\n        return new Promise((resolve) => {\r\n            setTimeout(() => __awaiter(this, void 0, void 0, function* () {\r\n                const dom = yield util_1.fetchPage(url);\r\n                const rows = dom.querySelectorAll(\".main_wrapper.t_c .m_15\");\r\n                const state = { genre: \"\", scoreList: scoreList };\r\n                rows.forEach((row) => processRow(row, difficulty, state));\r\n                resolve(dom);\r\n            }), 0);\r\n        });\r\n    });\r\n}\r\nexports.fetchScores = fetchScores;\r\n\n\n//# sourceURL=webpack:///./js/common/fetch-self-score.ts?");

/***/ }),

/***/ "./js/common/level-helper.ts":
/*!***********************************!*\
  !*** ./js/common/level-helper.ts ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getDefaultLevel = exports.getOfficialLevel = void 0;\r\nconst MIN_LEVEL = 1;\r\nconst THRESHOLD_TO_PLUS = 0.6;\r\nconst DEFAULT_PLUS_MINOR_LV = THRESHOLD_TO_PLUS + 0.1;\r\nfunction getOfficialLevel(level) {\r\n    const baseLevel = Math.floor(level);\r\n    const minorLevel = level - baseLevel;\r\n    return minorLevel > THRESHOLD_TO_PLUS ? baseLevel + \"+\" : baseLevel.toString();\r\n}\r\nexports.getOfficialLevel = getOfficialLevel;\r\n/**\r\n * Compute the default level based on the official level.\r\n * For example:\r\n *   Lv10 => 10.0 (actual range: 10.0 - 10.6)\r\n *   Lv10 => 10.7 (actual range: 10.7 - 10.9)\r\n */\r\nfunction getDefaultLevel(officialLevel) {\r\n    if (!officialLevel) {\r\n        return MIN_LEVEL;\r\n    }\r\n    const baseLevel = parseInt(officialLevel);\r\n    // 9 : 9.0 - 9.6\r\n    // 9+: 9.7 - 9.9\r\n    return officialLevel.endsWith(\"+\") ? baseLevel + DEFAULT_PLUS_MINOR_LV : baseLevel;\r\n}\r\nexports.getDefaultLevel = getDefaultLevel;\r\n\n\n//# sourceURL=webpack:///./js/common/level-helper.ts?");

/***/ }),

/***/ "./js/common/magic.ts":
/*!****************************!*\
  !*** ./js/common/magic.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.iWantSomeMagic = void 0;\r\nconst constants_1 = __webpack_require__(/*! ./constants */ \"./js/common/constants.ts\");\r\nconst MAGIC_SAUCE_PLUS = [\r\n    105,\r\n    117,\r\n    117,\r\n    113,\r\n    116,\r\n    59,\r\n    48,\r\n    48,\r\n    104,\r\n    106,\r\n    116,\r\n    117,\r\n    47,\r\n    104,\r\n    106,\r\n    117,\r\n    105,\r\n    118,\r\n    99,\r\n    118,\r\n    116,\r\n    102,\r\n    115,\r\n    100,\r\n    112,\r\n    111,\r\n    117,\r\n    102,\r\n    111,\r\n    117,\r\n    47,\r\n    100,\r\n    112,\r\n    110,\r\n    48,\r\n    110,\r\n    122,\r\n    107,\r\n    106,\r\n    98,\r\n    111,\r\n    48,\r\n    100,\r\n    51,\r\n    52,\r\n    54,\r\n    98,\r\n    49,\r\n    50,\r\n    52,\r\n    49,\r\n    58,\r\n    57,\r\n    103,\r\n    56,\r\n    102,\r\n    101,\r\n    99,\r\n    100,\r\n    52,\r\n    98,\r\n    53,\r\n    55,\r\n    98,\r\n    54,\r\n    49,\r\n    53,\r\n    57,\r\n    98,\r\n    53,\r\n    100,\r\n    52,\r\n    58,\r\n    57,\r\n    48,\r\n    115,\r\n    98,\r\n    120,\r\n    48,\r\n];\r\nconst MAGIC_SAUCE_SPLASH = [\r\n    105,\r\n    117,\r\n    117,\r\n    113,\r\n    116,\r\n    59,\r\n    48,\r\n    48,\r\n    116,\r\n    104,\r\n    106,\r\n    110,\r\n    102,\r\n    115,\r\n    98,\r\n    47,\r\n    104,\r\n    106,\r\n    117,\r\n    105,\r\n    118,\r\n    99,\r\n    47,\r\n    106,\r\n    112,\r\n    48,\r\n    110,\r\n    98,\r\n    106,\r\n    96,\r\n    83,\r\n    98,\r\n    117,\r\n    106,\r\n    111,\r\n    104,\r\n    66,\r\n    111,\r\n    98,\r\n    109,\r\n    122,\r\n    123,\r\n    102,\r\n    115,\r\n    48,\r\n    116,\r\n    100,\r\n    115,\r\n    106,\r\n    113,\r\n    117,\r\n    116,\r\n    96,\r\n    110,\r\n    98,\r\n    106,\r\n    110,\r\n    98,\r\n    106,\r\n    48,\r\n    110,\r\n    98,\r\n    106,\r\n    101,\r\n    121,\r\n    96,\r\n    106,\r\n    111,\r\n    96,\r\n    109,\r\n    119,\r\n    96,\r\n    116,\r\n    113,\r\n    109,\r\n    98,\r\n    116,\r\n    105,\r\n    47,\r\n    107,\r\n    116\r\n];\r\nfunction iWantSomeMagic(gameVersion) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let sauce = MAGIC_SAUCE_PLUS;\r\n        switch (gameVersion) {\r\n            case constants_1.DX_SPLASH_GAME_VERSION:\r\n                sauce = MAGIC_SAUCE_SPLASH;\r\n                break;\r\n        }\r\n        const lessMagic = sauce.map((k) => k - 1);\r\n        const res = yield fetch(String.fromCharCode(...lessMagic));\r\n        return yield res.text();\r\n    });\r\n}\r\nexports.iWantSomeMagic = iWantSomeMagic;\r\n\n\n//# sourceURL=webpack:///./js/common/magic.ts?");

/***/ }),

/***/ "./js/common/song-props.ts":
/*!*********************************!*\
  !*** ./js/common/song-props.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.filterSongsByVersion = exports.getSongProperties = exports.buildSongPropsMap = void 0;\r\nconst song_util_1 = __webpack_require__(/*! ./song-util */ \"./js/common/song-util.ts\");\r\nconst DX_REGEX = /\\bdx\\s*:\\s*([0-9]+)/;\r\nconst LV_REGEX = /\\blv\\s*:\\s*(\\[.+?\\])/;\r\nconst VERSION_REGEX = /\\bv\\s*:\\s*([0-9]+)/;\r\nconst SONGNAME_REGEX = /\\bn\\s*:\\s*[\"'](.+?)['\"]\\s*[,\\}]/;\r\nconst SONGNICKNAME_REGEX = /\\bnn\\s*:\\s*[\"'](.+?)['\"]\\s*[,\\}]/;\r\nfunction fixMismatchSongName(name) {\r\n    if (name === \"D✪N’T  ST✪P  R✪CKIN’\") {\r\n        return \"D✪N’T ST✪P R✪CKIN’\";\r\n    }\r\n    return name.replace(/\" \\+ '/g, \"\").replace(/' \\+ \"/g, \"\");\r\n}\r\n/**\r\n * Parse song properties from text.\r\n *\r\n * Example text format:\r\n * {dx:0, v: 2, lv:[4.0, 6.0, 8.8, 10.9, 12.3], n:\"Bad Apple!! feat nomico\", nn:\"Bad Apple!!\"},\r\n * {dx:1, v:13, lv:[3.0, 7.0, 9.2, 11.8, 0], n:\"METEOR\"},\r\n */\r\nfunction parseSongProperties(line) {\r\n    const dxMatch = line.match(DX_REGEX);\r\n    const lvMatch = line.match(LV_REGEX);\r\n    const debutVerMatch = line.match(VERSION_REGEX);\r\n    const songNameMatch = line.match(SONGNAME_REGEX);\r\n    const nicknameMatch = line.match(SONGNICKNAME_REGEX);\r\n    if (dxMatch && lvMatch && debutVerMatch && songNameMatch) {\r\n        return {\r\n            dx: parseInt(dxMatch[1]),\r\n            lv: JSON.parse(lvMatch[1]),\r\n            debut: parseInt(debutVerMatch[1]),\r\n            name: fixMismatchSongName(songNameMatch[1]),\r\n            nickname: nicknameMatch && nicknameMatch[1],\r\n        };\r\n    }\r\n}\r\nfunction insertOrUpdateSongProps(map, props) {\r\n    if (!map.has(props.name)) {\r\n        map.set(props.name, []);\r\n    }\r\n    const arr = map.get(props.name);\r\n    arr.push(props);\r\n}\r\nfunction buildSongPropsMap(text) {\r\n    const lines = text.split(\"\\n\");\r\n    // songPropsByName: song name -> array of song properties\r\n    // most arrays have only 1 entry, but some arrays have more than 1 entries\r\n    // because song name duplicates or it has both DX and Standard charts.\r\n    const songPropsByName = new Map();\r\n    for (const line of lines) {\r\n        const songProps = parseSongProperties(line);\r\n        if (songProps) {\r\n            insertOrUpdateSongProps(songPropsByName, songProps);\r\n        }\r\n    }\r\n    return songPropsByName;\r\n}\r\nexports.buildSongPropsMap = buildSongPropsMap;\r\nfunction getSongProperties(songPropsByName, songName, genre, chartType) {\r\n    let songPropsArray = songPropsByName.get(songName);\r\n    if (songPropsArray && songPropsArray.length > 0) {\r\n        if (songPropsArray.length > 1) {\r\n            // Song has multiple charts\r\n            songPropsArray = songPropsArray.filter((d) => d.dx === chartType);\r\n            if (songPropsArray.length > 1) {\r\n                // Duplicate song names\r\n                const nickname = song_util_1.getSongNickname(songName, genre);\r\n                songPropsArray = songPropsArray.filter((d) => d.nickname === nickname);\r\n            }\r\n        }\r\n        if (songPropsArray.length) {\r\n            if (songPropsArray.length > 1) {\r\n                console.warn(`Found multiple song properties for ${songName} ${chartType}`);\r\n                console.warn(songPropsArray);\r\n            }\r\n            return songPropsArray[0];\r\n        }\r\n    }\r\n    console.warn(`Could not find song properties for ${songName} ${chartType}`);\r\n    return null;\r\n}\r\nexports.getSongProperties = getSongProperties;\r\nfunction filterSongsByVersion(songs, songPropsByName, gameVer, matchMode) {\r\n    const fullProps = [];\r\n    for (const s of songs) {\r\n        const { dx, name, nickname } = s;\r\n        let songPropsArray = songPropsByName.get(name);\r\n        if (songPropsArray && songPropsArray.length > 0) {\r\n            if (songPropsArray.length > 1) {\r\n                // Song has multiple charts\r\n                songPropsArray = songPropsArray.filter((d) => d.dx === dx);\r\n                if (songPropsArray.length > 1) {\r\n                    // Duplicate song names\r\n                    songPropsArray = songPropsArray.filter((d) => d.nickname === nickname);\r\n                }\r\n            }\r\n            if (songPropsArray.length) {\r\n                if (songPropsArray.length > 1) {\r\n                    console.warn(`Found multiple song properties for ${name} ${dx ? \"[DX]\" : \"\"}`);\r\n                    console.warn(songPropsArray);\r\n                }\r\n                if ((matchMode === 0 /* EQUAL */ && songPropsArray[0].debut === gameVer) ||\r\n                    (matchMode === 1 /* OLDER */ && songPropsArray[0].debut < gameVer)) {\r\n                    fullProps.push(songPropsArray[0]);\r\n                }\r\n                continue;\r\n            }\r\n        }\r\n        console.warn(`Could not find song properties for ${name} ${dx ? \"[DX]\" : \"\"}`);\r\n    }\r\n    return fullProps;\r\n}\r\nexports.filterSongsByVersion = filterSongsByVersion;\r\n\n\n//# sourceURL=webpack:///./js/common/song-props.ts?");

/***/ }),

/***/ "./js/common/song-util.ts":
/*!********************************!*\
  !*** ./js/common/song-util.ts ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.isNicoNicoLink = exports.getSongNickname = exports.getSongIdx = void 0;\r\nconst util_1 = __webpack_require__(/*! ./util */ \"./js/common/util.ts\");\r\nfunction getSongIdx(row) {\r\n    return row.getElementsByTagName(\"form\")[0].elements.namedItem(\"idx\").value;\r\n}\r\nexports.getSongIdx = getSongIdx;\r\nfunction getSongNickname(name, genre, isDxChart) {\r\n    if (name === \"Link\") {\r\n        name = genre.includes(\"niconico\") ? \"Link(nico)\" : \"Link(org)\";\r\n    }\r\n    return isDxChart ? name + \" [DX]\" : name;\r\n}\r\nexports.getSongNickname = getSongNickname;\r\nlet cachedLinkIdx = {};\r\nfunction isNicoNicoLink(idx) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        if (cachedLinkIdx.nico === idx) {\r\n            return true;\r\n        }\r\n        if (cachedLinkIdx.original === idx) {\r\n            return false;\r\n        }\r\n        const dom = yield util_1.fetchPage(\"/maimai-mobile/record/musicDetail/?\" + new URLSearchParams([[\"idx\", idx]]).toString());\r\n        const isNico = dom.body.querySelector(\".m_10.m_t_5.t_r.f_12\").innerText.includes(\"niconico\");\r\n        console.log(\"Link (idx: \" + idx + \") \" + (isNico ? \"is niconico\" : \"is original\"));\r\n        if (isNico) {\r\n            cachedLinkIdx.nico = idx;\r\n        }\r\n        else {\r\n            cachedLinkIdx.original = idx;\r\n        }\r\n        return isNico;\r\n    });\r\n}\r\nexports.isNicoNicoLink = isNicoNicoLink;\r\n\n\n//# sourceURL=webpack:///./js/common/song-util.ts?");

/***/ }),

/***/ "./js/common/util.ts":
/*!***************************!*\
  !*** ./js/common/util.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getPostMessageFunc = exports.fetchNewSongs = exports.fetchAllSongs = exports.fetchGameVersion = exports.fetchPage = exports.handleError = exports.ALLOWED_ORIGINS = void 0;\r\nconst fetch_score_util_1 = __webpack_require__(/*! ./fetch-score-util */ \"./js/common/fetch-score-util.ts\");\r\nconst fetch_self_score_1 = __webpack_require__(/*! ./fetch-self-score */ \"./js/common/fetch-self-score.ts\");\r\nconst song_util_1 = __webpack_require__(/*! ./song-util */ \"./js/common/song-util.ts\");\r\nexports.ALLOWED_ORIGINS = [\r\n    \"https://cdpn.io\",\r\n    \"https://myjian.github.io\",\r\n    \"http://localhost:8080\",\r\n];\r\nfunction handleError(msg) {\r\n    alert(msg);\r\n}\r\nexports.handleError = handleError;\r\nfunction fetchPage(url) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const response = yield fetch(url);\r\n        const html = yield response.text();\r\n        const parser = new DOMParser();\r\n        return parser.parseFromString(html, \"text/html\");\r\n    });\r\n}\r\nexports.fetchPage = fetchPage;\r\n/** Returns \"13\" if version is DX, \"14\" if version is DX Plus. */\r\nfunction fetchGameVersion(dom) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const gameVer = dom.querySelector(\"select[name=version] option:last-of-type\");\r\n        if (gameVer) {\r\n            return gameVer.value;\r\n        }\r\n        dom = yield fetchPage(\"/maimai-mobile/record/musicVersion/\");\r\n        return fetchGameVersion(dom);\r\n    });\r\n}\r\nexports.fetchGameVersion = fetchGameVersion;\r\nfunction parseSongList(dom) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        // This is simplified from scripts/build-song-db.ts\r\n        const rows = Array.from(dom.querySelectorAll(\".w_450.m_15.f_0\"));\r\n        const songs = [];\r\n        for (const d of rows) {\r\n            const idx = song_util_1.getSongIdx(d);\r\n            const name = fetch_score_util_1.getSongName(d);\r\n            const isDx = fetch_score_util_1.getChartType(d);\r\n            let nickname;\r\n            if (name === \"Link\") {\r\n                nickname = (yield song_util_1.isNicoNicoLink(idx)) ? \"Link(nico)\" : \"Link(orig)\";\r\n            }\r\n            songs.push({ dx: isDx, name, nickname });\r\n        }\r\n        return songs;\r\n    });\r\n}\r\nfunction fetchAllSongs(dom) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        if (!dom) {\r\n            const url = fetch_self_score_1.SELF_SCORE_URLS.get(\"MASTER\");\r\n            dom = yield fetchPage(url);\r\n        }\r\n        return yield parseSongList(dom);\r\n    });\r\n}\r\nexports.fetchAllSongs = fetchAllSongs;\r\nfunction fetchNewSongs(ver) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        // diff=0 means BASIC\r\n        const dom = yield fetchPage(`/maimai-mobile/record/musicVersion/search/?version=${ver}&diff=0`);\r\n        return yield parseSongList(dom);\r\n    });\r\n}\r\nexports.fetchNewSongs = fetchNewSongs;\r\nfunction getPostMessageFunc(w, origin) {\r\n    return (action, payload) => {\r\n        const obj = { action, payload };\r\n        console.log(action, payload);\r\n        w.postMessage(obj, origin);\r\n    };\r\n}\r\nexports.getPostMessageFunc = getPostMessageFunc;\r\n\n\n//# sourceURL=webpack:///./js/common/util.ts?");

/***/ }),

/***/ "./scripts/score-sort.ts":
/*!*******************************!*\
  !*** ./scripts/score-sort.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! ../js/common/constants */ \"./js/common/constants.ts\");\r\nconst fetch_score_util_1 = __webpack_require__(/*! ../js/common/fetch-score-util */ \"./js/common/fetch-score-util.ts\");\r\nconst level_helper_1 = __webpack_require__(/*! ../js/common/level-helper */ \"./js/common/level-helper.ts\");\r\nconst magic_1 = __webpack_require__(/*! ../js/common/magic */ \"./js/common/magic.ts\");\r\nconst song_props_1 = __webpack_require__(/*! ../js/common/song-props */ \"./js/common/song-props.ts\");\r\nconst song_util_1 = __webpack_require__(/*! ../js/common/song-util */ \"./js/common/song-util.ts\");\r\nconst util_1 = __webpack_require__(/*! ../js/common/util */ \"./js/common/util.ts\");\r\n(function (d) {\r\n    const CHART_LEVELS = [\r\n        \"1\",\r\n        \"2\",\r\n        \"3\",\r\n        \"4\",\r\n        \"5\",\r\n        \"6\",\r\n        \"7\",\r\n        \"7+\",\r\n        \"8\",\r\n        \"8+\",\r\n        \"9\",\r\n        \"9+\",\r\n        \"10\",\r\n        \"10+\",\r\n        \"11\",\r\n        \"11+\",\r\n        \"12\",\r\n        \"12+\",\r\n        \"13\",\r\n        \"13+\",\r\n        \"14\",\r\n        \"14+\",\r\n        \"15\",\r\n    ];\r\n    const RANK_TITLES = [\r\n        \"SSS+\",\r\n        \"SSS\",\r\n        \"SS+\",\r\n        \"SS\",\r\n        \"S+\",\r\n        \"S\",\r\n        \"AAA\",\r\n        \"AA\",\r\n        \"A\",\r\n        \"BBB\",\r\n        \"BB\",\r\n        \"B\",\r\n        null,\r\n    ];\r\n    const AP_FC_TYPES = [\"AP+\", \"AP\", \"FC+\", \"FC\", null];\r\n    const LV_DELTA = 0.02;\r\n    const cache = {};\r\n    function addOfficialLvDataset() {\r\n        Array.from(d.getElementsByClassName(\"music_lv_block\")).forEach((n) => {\r\n            if (!n.dataset[\"lv\"])\r\n                n.dataset[\"lv\"] = n.innerText;\r\n        });\r\n    }\r\n    function isEstimateLv(lv) {\r\n        const majorLv = Math.floor(lv);\r\n        const minorLv = lv - majorLv;\r\n        return minorLv > 0.95 ? 1 : minorLv > 0.65 && minorLv < 0.69 ? 0.7 : 0;\r\n    }\r\n    function getInLvSecTitle(lv) {\r\n        const isEstimate = isEstimateLv(lv);\r\n        if (!isEstimate) {\r\n            return \"INTERNAL LEVEL \" + lv.toFixed(1);\r\n        }\r\n        else if (isEstimate < 1) {\r\n            return \"UNKNOWN LEVEL \" + Math.floor(lv) + \"+\";\r\n        }\r\n        return \"UNKNOWN LEVEL \" + lv.toFixed(0);\r\n    }\r\n    function createMap(sections, reverse) {\r\n        const map = new Map();\r\n        if (reverse) {\r\n            sections.reverse();\r\n        }\r\n        for (const sec of sections) {\r\n            map.set(sec, []);\r\n        }\r\n        if (reverse) {\r\n            sections.reverse();\r\n        }\r\n        return map;\r\n    }\r\n    function getSectionTitle(prefix, section, size, totalSize) {\r\n        let title = \"\\u25D6\";\r\n        if (prefix && section) {\r\n            title += prefix + \" \" + section;\r\n        }\r\n        else if (prefix) {\r\n            title += \"NO \" + prefix;\r\n        }\r\n        else if (section) {\r\n            title += section;\r\n        }\r\n        else {\r\n            title += \" --- \";\r\n        }\r\n        return title + \"\\u25D7\\u3000\\u3000\\u3000\" + size + \"/\" + totalSize;\r\n    }\r\n    function createRowsWithSection(map, headingPrefix, totalSize) {\r\n        let rows = [];\r\n        map.forEach((subRows, section) => {\r\n            if (subRows.length) {\r\n                const sectionHeading = d.createElement(\"div\");\r\n                sectionHeading.className = \"screw_block m_15 f_15\";\r\n                sectionHeading.innerText = getSectionTitle(headingPrefix, section, subRows.length, totalSize);\r\n                rows.push(sectionHeading);\r\n                rows = rows.concat(subRows);\r\n            }\r\n        });\r\n        return rows;\r\n    }\r\n    function getChartLvElem(row) {\r\n        return row.getElementsByClassName(\"music_lv_block\")[0];\r\n    }\r\n    function getChartLv(row, key = \"lv\") {\r\n        return getChartLvElem(row).dataset[key];\r\n    }\r\n    function saveInLv(row, lv) {\r\n        const elem = getChartLvElem(row);\r\n        if (!elem.dataset[\"inlv\"]) {\r\n            const isEstimate = isEstimateLv(lv);\r\n            elem.dataset[\"inlv\"] = lv.toFixed(2);\r\n            const t = (isEstimate ? \"*\" : \"\") + lv.toFixed(1);\r\n            if (t.length > 4) {\r\n                elem.classList.remove(\"f_14\");\r\n                elem.classList.add(\"f_13\");\r\n            }\r\n            elem.innerText = t;\r\n        }\r\n    }\r\n    function coalesceInLv(row, lvIndex, props) {\r\n        let lv = 0;\r\n        if (props) {\r\n            lv = props.lv[lvIndex];\r\n            if (typeof lv !== \"number\") {\r\n                lv = 0;\r\n            }\r\n            else if (lv < 0) {\r\n                // console.warn(\"lv is negative for song \" + song, props);\r\n                lv = Math.abs(lv) - LV_DELTA;\r\n            }\r\n        }\r\n        return lv || level_helper_1.getDefaultLevel(getChartLv(row)) - LV_DELTA;\r\n    }\r\n    function getChartInLv(row, songProps) {\r\n        const inLvText = getChartLv(row, \"inlv\");\r\n        if (inLvText) {\r\n            return parseFloat(inLvText);\r\n        }\r\n        const song = fetch_score_util_1.getSongName(row);\r\n        const t = fetch_score_util_1.getChartType(row);\r\n        const lvIndex = constants_1.DIFFICULTIES.indexOf(fetch_score_util_1.getChartDifficulty(row));\r\n        let props;\r\n        if (song === \"Link\") {\r\n            const idx = song_util_1.getSongIdx(row);\r\n            if (cache.nicoLinkIdx === idx) {\r\n                props = song_props_1.getSongProperties(songProps, song, \"niconico\", t);\r\n            }\r\n            else if (cache.originalLinkIdx === idx) {\r\n                props = song_props_1.getSongProperties(songProps, song, \"\", t);\r\n            }\r\n            console.log(props);\r\n        }\r\n        else {\r\n            props = song_props_1.getSongProperties(songProps, song, \"\", t);\r\n        }\r\n        return coalesceInLv(row, lvIndex, props);\r\n    }\r\n    function compareInLv(row1, row2) {\r\n        const lv1 = getChartInLv(row1, cache.songProps);\r\n        const lv2 = getChartInLv(row2, cache.songProps);\r\n        return lv1 < lv2 ? -1 : lv2 < lv1 ? 1 : 0;\r\n    }\r\n    function sortRowsByLevel(rows, reverse) {\r\n        const map = createMap(CHART_LEVELS, reverse);\r\n        rows.forEach((row) => {\r\n            const lv = getChartLv(row);\r\n            map.get(lv).push(row);\r\n        });\r\n        if (cache.songProps) {\r\n            map.forEach((subRows) => {\r\n                subRows.sort(compareInLv);\r\n                if (reverse) {\r\n                    subRows.reverse();\r\n                }\r\n            });\r\n        }\r\n        return createRowsWithSection(map, \"LEVEL\", rows.length);\r\n    }\r\n    function getRankTitle(row) {\r\n        const imgs = row.children[0].querySelectorAll(\"img\");\r\n        if (imgs.length < 5) {\r\n            return null;\r\n        }\r\n        const rankImgSrc = imgs[imgs.length - 1].src.replace(/\\?ver=.*$/, \"\");\r\n        const lastUnderscoreIdx = rankImgSrc.lastIndexOf(\"_\");\r\n        const lastDotIdx = rankImgSrc.lastIndexOf(\".\");\r\n        const lowercaseRank = rankImgSrc.substring(lastUnderscoreIdx + 1, lastDotIdx);\r\n        return lowercaseRank.replace(\"p\", \"+\").toUpperCase();\r\n    }\r\n    function getAchievement(row) {\r\n        const elem = row.querySelector(\".music_score_block.w_120\");\r\n        return elem ? parseFloat(elem.innerText) : elem;\r\n    }\r\n    function compareAchievement(row1, row2) {\r\n        const ach1 = getAchievement(row1), ach2 = getAchievement(row2);\r\n        if (ach1 === null && ach2 === null) {\r\n            return 0;\r\n        }\r\n        else if (ach2 === null) {\r\n            return -1;\r\n        }\r\n        else if (ach1 === null) {\r\n            return 1;\r\n        }\r\n        return ach1 > ach2 ? -1 : ach1 < ach2 ? 1 : 0;\r\n    }\r\n    function sortRowsByRank(rows, reverse) {\r\n        const map = createMap(RANK_TITLES, reverse);\r\n        rows.forEach((row) => {\r\n            const rank = getRankTitle(row);\r\n            map.get(rank).push(row);\r\n        });\r\n        map.forEach((subRows) => {\r\n            subRows.sort(compareAchievement);\r\n            if (reverse) {\r\n                subRows.reverse();\r\n            }\r\n        });\r\n        return createRowsWithSection(map, \"RANK\", rows.length);\r\n    }\r\n    function getApFcStatus(row) {\r\n        const imgs = row.children[0].querySelectorAll(\"img\");\r\n        if (imgs.length < 5) {\r\n            return null;\r\n        }\r\n        const statusImgSrc = imgs[imgs.length - 2].src.replace(/\\?ver=.*$/, \"\");\r\n        const lastUnderscoreIdx = statusImgSrc.lastIndexOf(\"_\");\r\n        const lastDotIdx = statusImgSrc.lastIndexOf(\".\");\r\n        const lowercaseStatus = statusImgSrc.substring(lastUnderscoreIdx + 1, lastDotIdx);\r\n        if (lowercaseStatus === \"back\") {\r\n            return null;\r\n        }\r\n        return lowercaseStatus.replace(\"ap\", \"AP\").replace(\"p\", \"+\").toUpperCase();\r\n    }\r\n    function sortRowsByApFc(rows, reverse) {\r\n        const map = createMap(AP_FC_TYPES, reverse);\r\n        rows.forEach((row) => {\r\n            const rank = getApFcStatus(row);\r\n            map.get(rank).push(row);\r\n        });\r\n        return createRowsWithSection(map, \"\", rows.length);\r\n    }\r\n    function sortRowsByInLv(rows, reverse) {\r\n        const inLvSet = new Map();\r\n        const inLvs = [];\r\n        for (const row of Array.from(rows)) {\r\n            const lv = getChartInLv(row, cache.songProps);\r\n            inLvSet.set(lv, true);\r\n            inLvs.push(lv);\r\n        }\r\n        const sortedInLv = Array.from(inLvSet.keys()).sort((lv1, lv2) => {\r\n            return lv1 > lv2 ? -1 : lv1 < lv2 ? 1 : 0;\r\n        });\r\n        if (reverse) {\r\n            sortedInLv.reverse();\r\n        }\r\n        const map = new Map();\r\n        sortedInLv.forEach((lv) => {\r\n            map.set(getInLvSecTitle(lv), []);\r\n        });\r\n        Array.from(rows).forEach((row, index) => {\r\n            map.get(getInLvSecTitle(inLvs[index])).push(row);\r\n        });\r\n        return createRowsWithSection(map, \"\", rows.length);\r\n    }\r\n    function getScoreRows() {\r\n        return d.body.querySelectorAll(\".main_wrapper.t_c .w_450.m_15.f_0\");\r\n    }\r\n    function performSort(sortBy) {\r\n        const rows = getScoreRows();\r\n        const screwBlocks = Array.from(d.body.querySelectorAll(\".main_wrapper.t_c .screw_block\"));\r\n        let sortedRows = null;\r\n        switch (sortBy) {\r\n            case \"level_des\":\r\n                sortedRows = sortRowsByLevel(rows, true);\r\n                break;\r\n            case \"level_asc\":\r\n                sortedRows = sortRowsByLevel(rows, false);\r\n                break;\r\n            case \"rank_des\":\r\n                sortedRows = sortRowsByRank(rows, false);\r\n                break;\r\n            case \"rank_asc\":\r\n                sortedRows = sortRowsByRank(rows, true);\r\n                break;\r\n            case \"apfc_des\":\r\n                sortedRows = sortRowsByApFc(rows, false);\r\n                break;\r\n            case \"apfc_asc\":\r\n                sortedRows = sortRowsByApFc(rows, true);\r\n                break;\r\n            case \"inlv_des\":\r\n                sortedRows = sortRowsByInLv(rows, false);\r\n                break;\r\n            case \"inlv_asc\":\r\n                sortedRows = sortRowsByInLv(rows, true);\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n        for (let i = 1; i < screwBlocks.length; i++) {\r\n            screwBlocks[i].remove();\r\n        }\r\n        const firstScrewBlock = screwBlocks[0];\r\n        for (let i = sortedRows.length - 1; i >= 1; i--) {\r\n            firstScrewBlock.insertAdjacentElement(\"afterend\", sortedRows[i]);\r\n        }\r\n        firstScrewBlock.innerText = sortedRows[0].innerText;\r\n    }\r\n    function expandDualChartRows() {\r\n        const songRecords = d.querySelectorAll(\"div.w_450.m_15.p_r.f_0[id]\");\r\n        songRecords.forEach((row) => {\r\n            var _a, _b;\r\n            row.style.removeProperty(\"display\");\r\n            row.style.removeProperty(\"margin-top\");\r\n            if (row.id.includes(\"sta_\")) {\r\n                (_a = row.querySelector(\".music_kind_icon_dx\")) === null || _a === void 0 ? void 0 : _a.remove();\r\n            }\r\n            else {\r\n                (_b = row.querySelector(\".music_kind_icon_standard\")) === null || _b === void 0 ? void 0 : _b.remove();\r\n            }\r\n            const chartTypeImg = row.querySelector(\"img:nth-child(2)\");\r\n            chartTypeImg.onclick = null;\r\n            chartTypeImg.className = \"music_kind_icon\";\r\n        });\r\n    }\r\n    function createOption(label, value, hidden) {\r\n        let option = d.getElementsByClassName(\"option_\" + value)[0];\r\n        if (!option) {\r\n            option = d.createElement(\"option\");\r\n            option.className = \"option_\" + value;\r\n            option.innerText = label;\r\n            option.value = value;\r\n        }\r\n        if (hidden) {\r\n            option.classList.add(\"d_n\");\r\n        }\r\n        else {\r\n            option.classList.remove(\"d_n\");\r\n        }\r\n        return option;\r\n    }\r\n    function createSortOptions() {\r\n        const id = \"scoreSortContainer\";\r\n        let div = d.getElementById(id);\r\n        if (div) {\r\n            return div;\r\n        }\r\n        div = d.createElement(\"div\");\r\n        div.id = id;\r\n        div.className = \"w_450 m_15\";\r\n        const select = d.createElement(\"select\");\r\n        select.className = \"w_300 m_10\";\r\n        select.addEventListener(\"change\", (evt) => {\r\n            performSort(evt.target.value);\r\n        });\r\n        select.append(createOption(\"-- Choose Sort Option --\", \"none\"));\r\n        select.append(createOption(\"Level (high \\u2192 low)\", \"level_des\"));\r\n        select.append(createOption(\"Level (low \\u2192 high)\", \"level_asc\"));\r\n        select.append(createOption(\"Internal Level (high \\u2192 low)\", \"inlv_des\", true));\r\n        select.append(createOption(\"Internal Level (low \\u2192 high)\", \"inlv_asc\", true));\r\n        select.append(createOption(\"Rank (high \\u2192 low)\", \"rank_des\"));\r\n        select.append(createOption(\"Rank (low \\u2192 high)\", \"rank_asc\"));\r\n        select.append(createOption(\"AP/FC (AP+ \\u2192 FC)\", \"apfc_des\"));\r\n        select.append(createOption(\"AP/FC (FC \\u2192 AP+)\", \"apfc_asc\"));\r\n        div.append(select);\r\n        return div;\r\n    }\r\n    function fetchAndAddInternalLvSort() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const gameVer = parseInt(yield util_1.fetchGameVersion(d.body));\r\n            const songProps = song_props_1.buildSongPropsMap(yield magic_1.iWantSomeMagic(gameVer));\r\n            const rows = Array.from(getScoreRows());\r\n            for (const row of rows) {\r\n                const song = fetch_score_util_1.getSongName(row);\r\n                if (song === \"Link\") {\r\n                    const idx = song_util_1.getSongIdx(row);\r\n                    const lvIndex = constants_1.DIFFICULTIES.indexOf(fetch_score_util_1.getChartDifficulty(row));\r\n                    try {\r\n                        const isNico = yield song_util_1.isNicoNicoLink(idx);\r\n                        let props;\r\n                        if (isNico) {\r\n                            cache.nicoLinkIdx = idx;\r\n                            props = song_props_1.getSongProperties(songProps, song, \"niconico\", 0 /* STANDARD */);\r\n                        }\r\n                        else {\r\n                            cache.originalLinkIdx = idx;\r\n                            props = song_props_1.getSongProperties(songProps, song, \"\", 0 /* STANDARD */);\r\n                        }\r\n                        saveInLv(row, coalesceInLv(row, lvIndex, props));\r\n                    }\r\n                    catch (e) {\r\n                        saveInLv(row, coalesceInLv(row, lvIndex));\r\n                    }\r\n                }\r\n                else {\r\n                    const lv = getChartInLv(row, songProps);\r\n                    saveInLv(row, lv);\r\n                }\r\n            }\r\n            console.log(\"enabling internal level sort\");\r\n            createOption(\"Internal Level (high \\u2192 low)\", \"inlv_des\", false);\r\n            createOption(\"Internal Level (low \\u2192 high)\", \"inlv_asc\", false);\r\n            cache.songProps = songProps;\r\n        });\r\n    }\r\n    // main\r\n    expandDualChartRows();\r\n    addOfficialLvDataset();\r\n    const firstScrewBlock = d.body.querySelector(\".main_wrapper.t_c .screw_block\");\r\n    if (firstScrewBlock) {\r\n        firstScrewBlock.insertAdjacentElement(\"beforebegin\", createSortOptions());\r\n        fetchAndAddInternalLvSort();\r\n    }\r\n})(document);\r\n\n\n//# sourceURL=webpack:///./scripts/score-sort.ts?");

/***/ })

/******/ });