!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=53)}([function(e,t){e.exports=React},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LANG=void 0;const a=new URLSearchParams(document.location.search);let r="en";a.get("hl")?r=a.get("hl").startsWith("zh")?"zh":"en":navigator.language.startsWith("zh")&&(r="zh"),t.LANG=r},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function s(e){try{l(a.next(e))}catch(e){o(e)}}function i(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getPostMessageFunc=t.fetchNewSongs=t.fetchAllSongs=t.fetchGameVersion=t.fetchPage=t.handleError=t.ALLOWED_ORIGINS=void 0;const r=n(3),o=n(6),s=n(4);function i(e){return a(this,void 0,void 0,(function*(){const t=yield fetch(e),n=yield t.text();return(new DOMParser).parseFromString(n,"text/html")}))}function l(e){return a(this,void 0,void 0,(function*(){const t=Array.from(e.querySelectorAll(".w_450.m_15.f_0")),n=[];for(const e of t){const t=s.getSongIdx(e),a=r.getSongName(e),o=r.getChartType(e);let i;"Link"===a&&(i=(yield s.isNicoNicoLink(t))?"Link(nico)":"Link(orig)"),n.push({dx:o,name:a,nickname:i})}return n}))}t.ALLOWED_ORIGINS=["https://cdpn.io","https://myjian.github.io","http://localhost:8080"],t.handleError=function(e){alert(e)},t.fetchPage=i,t.fetchGameVersion=function e(t){return a(this,void 0,void 0,(function*(){const n=t.querySelector("select[name=version] option:last-of-type");return n?n.value:e(t=yield i("/maimai-mobile/record/musicVersion/"))}))},t.fetchAllSongs=function(e){return a(this,void 0,void 0,(function*(){if(!e){const t=o.SELF_SCORE_URLS.get("MASTER");e=yield i(t)}return yield l(e)}))},t.fetchNewSongs=function(e){return a(this,void 0,void 0,(function*(){const t=yield i(`/maimai-mobile/record/musicVersion/search/?version=${e}&diff=0`);return yield l(t)}))},t.getPostMessageFunc=function(e,t){return(n,a)=>{const r={action:n,payload:a};e.postMessage(r,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPlayerGrade=t.getPlayerName=t.getChartType=t.getChartDifficulty=t.getChartLevel=t.getSongName=void 0,t.getSongName=function(e){return e.getElementsByClassName("music_name_block")[0].innerText},t.getChartLevel=function(e){return e.getElementsByClassName("music_lv_block")[0].innerText},t.getChartDifficulty=function(e){if(!e.classList.contains("pointer")){const t=e.querySelector(".pointer");e=t||e}const t=e.className.match(/music_([a-z]+)_score_back/)[1].toUpperCase();return 0===t.indexOf("RE")?"Re:MASTER":t},t.getChartType=function(e){return e.id?e.id.includes("sta_")?0:1:e.querySelector("img:nth-child(2)").src.includes("_standard")?0:1},t.getPlayerName=function(e){var t;return null===(t=e.querySelector(".name_block"))||void 0===t?void 0:t.innerText},t.fetchPlayerGrade=function(e){const t=e.querySelector(".user_data_block_line ~ img.h_25");if(t){const e=t.src.lastIndexOf("grade_");return t.src.substring(e+6,e+8)}return null}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function s(e){try{l(a.next(e))}catch(e){o(e)}}function i(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.isNicoNicoLink=t.getSongNickname=t.getSongIdx=void 0;const r=n(2);t.getSongIdx=function(e){return e.getElementsByTagName("form")[0].elements.namedItem("idx").value},t.getSongNickname=function(e,t,n){return"Link"===e&&(e=t.includes("niconico")?"Link(nico)":"Link(org)"),n?e+" [DX]":e};let o={};t.isNicoNicoLink=function(e){return a(this,void 0,void 0,(function*(){if(o.nico===e)return!0;if(o.original===e)return!1;const t=(yield r.fetchPage("/maimai-mobile/record/musicDetail/?"+new URLSearchParams([["idx",e]]).toString())).body.querySelector(".m_10.m_t_5.t_r.f_12").innerText.includes("niconico");return console.log("Link (idx: "+e+") "+(t?"is niconico":"is original")),t?o.nico=e:o.original=e,t}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIString=void 0;const a=n(1);t.UIString={en:{gameVer:"Game version:",internalLvHeading:"Chart Internal Level Data",manualLv:"Manual input",autoLv:"Automatic",scoreInputHeading:"Player Scores",scoreInputDescPrefix:'Please use "Analyze Self DX Rating" or "Analyze Friend\'s DX Rating" from ',bookmarketLinkLabel:"maimai bookmarklets",scoreInputDescSuffix:" to fill in this field.",computeRating:"Calculate Rating",analysisResult:"Analysis Result",newChartsRecLv:"New Charts",oldChartsRecLv:"Old Charts",newChartsRating:"New Charts Rating",oldChartsRating:"Old Charts Rating",grade:"Grade",ratingTargetLvDistribution:"Levels of Rating Subjects",ratingTargetDiffDistribution:"Difficulties of Rating Subjects",column:":",subtotal:"Subtotal",newChartsRatingTargets:"New Charts Rating Subjects (best 15):",oldChartsRatingTargets:"Old Charts Rating Subjects (best 25):",newChartsRatingCandidates:"New Charts Rating Candidates:",oldChartsRatingCandidates:"Old Charts Rating Candidates:",num:"#",song:"Song",difficulty:"Difficulty",level:"Level",rating:"Rating",nextGoal:"Next Goal",nextRating:"+Rating",rankFactorTable:"Rank Factor Table",rank:"Rank",achievement:"Achievement",achievementAbbr:"Achv",factor:"Factor",multiplier:"Multiplier (Factor × Achievement)",otherToolsHeading:"Other Tools",ratingVisualizer:"Rating Visualizer (Interactive Page)",bookmarketList:"Bookmarklets list",showMore:"Show more",showLess:"Show less",recommendedLevels:"Recommended levels",tilde:"~",projectedRating:"Potential Rating",levelComment:"Note: X.7 and above is classified under X+. For example, 10.7, 10.8, and 10.9 are 10+.",average:"Average",showPlayed:"Show played charts",showNotPlayed:"Show not yet played charts"},zh:{gameVer:"遊戲版本：",internalLvHeading:"譜面定數",manualLv:"手動輸入",autoLv:"自動代入",scoreInputHeading:"玩家成績輸入",scoreInputDescPrefix:"請用 ",bookmarketLinkLabel:"maimai 書籤小工具",scoreInputDescSuffix:" 中的「分析自己 DX Rating」或「分析好友 DX Rating」填入此欄。",computeRating:"計算 Rating 值",analysisResult:"分析結果",newChartsRecLv:"新譜面",oldChartsRecLv:"舊譜面",newChartsRating:"新譜面 Rating",oldChartsRating:"舊譜面 Rating",grade:"段位",ratingTargetLvDistribution:"Rating 對象曲 等級分布",ratingTargetDiffDistribution:"Rating 對象曲 難度分布",column:"：",subtotal:"小計",newChartsRatingTargets:"新譜面 Rating 對象曲 (取最佳 15 首)：",oldChartsRatingTargets:"舊譜面 Rating 對象曲 (取最佳 25 首)：",newChartsRatingCandidates:"新譜面 Rating 候選曲：",oldChartsRatingCandidates:"舊譜面 Rating 候選曲：",num:"#",song:"歌曲",difficulty:"難度",level:"等級",rating:"R 值",nextGoal:"下個\n目標",nextRating:"R 值\n加分",rankFactorTable:"Rank 係數表",rank:"Rank",achievement:"達成率",achievementAbbr:"達成率",factor:"係數",multiplier:"倍率 (係數 × 達成率)",otherToolsHeading:"其他工具",ratingVisualizer:"R 值視覺化互動式網頁",bookmarketList:"書籤小工具列表",showMore:"顯示更多",showLess:"顯示較少",recommendedLevels:"刷分目標 (推薦等級)",tilde:"～",projectedRating:"可獲得 R 值",levelComment:"註：X.7 以上是歸類在官方的 X+。舉例來說：10.7, 10.8, 10.9 都算是 10+。",average:"平均",showPlayed:"顯示已玩過的譜面",showNotPlayed:"顯示未玩過的譜面"}}[a.LANG]},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function s(e){try{l(a.next(e))}catch(e){o(e)}}function i(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchScores=t.SELF_SCORE_URLS=void 0;const r=n(3),o=n(2);t.SELF_SCORE_URLS=new Map([["Re:MASTER","/maimai-mobile/record/musicGenre/search/?genre=99&diff=4"],["MASTER","/maimai-mobile/record/musicGenre/search/?genre=99&diff=3"],["EXPERT","/maimai-mobile/record/musicGenre/search/?genre=99&diff=2"],["ADVANCED","/maimai-mobile/record/musicGenre/search/?genre=99&diff=1"]]),t.fetchScores=function(e,n){return a(this,void 0,void 0,(function*(){const a=t.SELF_SCORE_URLS.get(e);if(!a)return;const s=yield o.fetchPage(a),i=s.querySelectorAll(".main_wrapper.t_c .m_15"),l={genre:"",scoreList:n};return i.forEach(t=>function(e,t,n){const a=e.classList.contains("screw_block"),o=e.classList.contains("w_450")&&e.classList.contains("m_15")&&e.classList.contains("p_r")&&e.classList.contains("f_0");if(a)n.genre=e.innerText;else if(o){const a=r.getSongName(e),o=r.getChartLevel(e),s=1===r.getChartType(e)?"DX":"STANDARD",i=function(e){const t=e.querySelector(".music_score_block.w_120");return t&&t.innerText}(e);if(!i)return;n.scoreList.push([a,n.genre,t,o,s,i].join("\t"))}}(t,e,l)),s}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DX_SPLASH_GAME_VERSION=t.DX_PLUS_GAME_VERSION=t.DX_GAME_VERSION=t.SSSPLUS_MIN_ACHIEVEMENT=t.DIFFICULTY_CLASSNAME_MAP=t.DIFFICULTIES=void 0,t.DIFFICULTIES=["BASIC","ADVANCED","EXPERT","MASTER","Re:MASTER"],t.DIFFICULTY_CLASSNAME_MAP=new Map([["Re:MASTER","remaster"],["MASTER","master"],["EXPERT","expert"],["ADVANCED","advanced"]]),t.SSSPLUS_MIN_ACHIEVEMENT=100.5,t.DX_GAME_VERSION=13,t.DX_PLUS_GAME_VERSION=14,t.DX_SPLASH_GAME_VERSION=15},function(e,t,n){"use strict";function a(e){return t.RANK_DEFINITIONS.findIndex(t=>e>=t.th)}function r(e){const n=a(e);return n<0?null:t.RANK_DEFINITIONS[n]}function o(e){const t=r(e);return t?t.title:"C"}Object.defineProperty(t,"__esModule",{value:!0}),t.getFinaleRankTitle=t.getRankTitle=t.getRankByAchievement=t.getRankIndexByAchievement=t.RANK_DEFINITIONS=void 0,t.RANK_DEFINITIONS=[{th:100.5,factor:14,title:"SSS+"},{th:100,factor:13.5,title:"SSS"},{th:99.5,factor:13.2,title:"SS+"},{th:99,factor:13,title:"SS"},{th:98,factor:12.7,title:"S+"},{th:97,factor:12.5,title:"S"},{th:94,factor:10.5,title:"AAA"},{th:90,factor:9.5,title:"AA"},{th:80,factor:8.5,title:"A"},{th:75,factor:7.5,title:"BBB"},{th:70,factor:7,title:"BB"},{th:60,factor:6,title:"B"},{th:50,factor:5,title:"C"}],t.getRankIndexByAchievement=a,t.getRankByAchievement=r,t.getRankTitle=o,t.getFinaleRankTitle=function(e){return o(e).replace("SSS+","SSS")}},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatFloat=t.roundFloat=t.sum=t.compareNumber=void 0,t.compareNumber=function(e,t){return e>t?1:e<t?-1:0},t.sum=function(e){let t=0;for(const n of e)t+=n;return t},t.roundFloat=function(e,t,n){return Math[t](e/n)*n},t.formatFloat=function(e,t){return e?e.toFixed(t):"0"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultLevel=t.getOfficialLevel=void 0;t.getOfficialLevel=function(e){const t=Math.floor(e);return e-t>.6?t+"+":t.toString()},t.getDefaultLevel=function(e){if(!e)return 1;const t=parseInt(e);return e.endsWith("+")?t+.7:t}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterSongsByVersion=t.getSongProperties=t.buildSongPropsMap=void 0;const a=n(4),r=/\bdx\s*:\s*([0-9]+)/,o=/\blv\s*:\s*(\[.+?\])/,s=/\bv\s*:\s*([0-9]+)/,i=/\bn\s*:\s*["'](.+?)['"]\s*[,\}]/,l=/\bnn\s*:\s*["'](.+?)['"]\s*[,\}]/;function c(e){const t=e.match(r),n=e.match(o),a=e.match(s),c=e.match(i),u=e.match(l);if(t&&n&&a&&c)return{dx:parseInt(t[1]),lv:JSON.parse(n[1]),debut:parseInt(a[1]),name:(d=c[1],"D✪N’T  ST✪P  R✪CKIN’"===d?"D✪N’T ST✪P R✪CKIN’":d.replace(/" \+ '/g,"").replace(/' \+ "/g,"")),nickname:u&&u[1]};var d}function u(e,t){e.has(t.name)||e.set(t.name,[]);e.get(t.name).push(t)}t.buildSongPropsMap=function(e){const t=e.split("\n"),n=new Map;for(const e of t){const t=c(e);t&&u(n,t)}return n},t.getSongProperties=function(e,t,n,r){let o=e.get(t);if(o&&o.length>0){if(o.length>1&&(o=o.filter(e=>e.dx===r),o.length>1)){const e=a.getSongNickname(t,n);o=o.filter(t=>t.nickname===e)}if(o.length)return o.length>1&&(console.warn(`Found multiple song properties for ${t} ${r}`),console.warn(o)),o[0]}return console.warn(`Could not find song properties for ${t} ${r}`),null},t.filterSongsByVersion=function(e,t,n,a){const r=[];for(const o of e){const{dx:e,name:s,nickname:i}=o;let l=t.get(s);l&&l.length>0&&(l.length>1&&(l=l.filter(t=>t.dx===e),l.length>1&&(l=l.filter(e=>e.nickname===i))),l.length)?(l.length>1&&(console.warn(`Found multiple song properties for ${s} ${e?"[DX]":""}`),console.warn(l)),(0===a&&l[0].debut===n||1===a&&l[0].debut<n)&&r.push(l[0])):console.warn(`Could not find song properties for ${s} ${e?"[DX]":""}`)}return r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compareSongsByDifficulty=t.compareSongsByNextRank=t.compareSongsByName=t.compareSongsByAchv=t.compareSongsByLevel=t.compareSongsByNextRating=t.compareCandidate=t.compareSongsByRating=void 0;const a=n(7);function r(e,t){return e>t?-1:Number(e<t)}function o(e,t,n){return r(e[n],t[n])}t.compareSongsByRating=function(e,t){return o(e,t,"rating")||o(e,t,"level")||o(e,t,"achievement")},t.compareCandidate=function(e,t){const n=e.nextRanks.values().next().value,a=n.minRt/(n.rank.th-e.achievement),s=t.nextRanks.values().next().value;return r(a,s.minRt/(s.rank.th-t.achievement))||r(n.minRt,s.minRt)||o(e,t,"level")},t.compareSongsByNextRating=function(e,t){const n=e.nextRanks.values().next().value,a=t.nextRanks.values().next().value;return r(n.minRt,a.minRt)||o(e,t,"level")},t.compareSongsByLevel=function(e,t){return o(t,e,"level")},t.compareSongsByAchv=function(e,t){return o(e,t,"achievement")},t.compareSongsByName=function(e,t){return n=t,e[a="songName"].localeCompare(n[a]);var n,a},t.compareSongsByNextRank=function(e,t){const n=e.nextRanks.values().next().value.rank,a=t.nextRanks.values().next().value.rank;return r(n.th,a.th)},t.compareSongsByDifficulty=function(e,t){return r(a.DIFFICULTIES.indexOf(e.difficulty),a.DIFFICULTIES.indexOf(t.difficulty))}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getZhWikiLink=void 0;t.getZhWikiLink=function(e){return"https://maimai.fandom.com/zh/wiki/"+encodeURIComponent(e)+"?variant=zh-hant"}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function s(e){try{l(a.next(e))}catch(e){o(e)}}function i(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.iWantSomeMagic=void 0;const r=n(7),o=[105,117,117,113,116,59,48,48,104,106,116,117,47,104,106,117,105,118,99,118,116,102,115,100,112,111,117,102,111,117,47,100,112,110,48,110,122,107,106,98,111,48,100,51,52,54,98,49,50,52,49,58,57,103,56,102,101,99,100,52,98,53,55,98,54,49,53,57,98,53,100,52,58,57,48,115,98,120,48],s=[105,117,117,113,116,59,48,48,116,104,106,110,102,115,98,47,104,106,117,105,118,99,47,106,112,48,110,98,106,96,83,98,117,106,111,104,66,111,98,109,122,123,102,115,48,116,100,115,106,113,117,116,96,110,98,106,110,98,106,48,110,98,106,101,121,96,106,111,96,109,119,96,116,113,109,98,116,105,47,107,116];t.iWantSomeMagic=function(e){return a(this,void 0,void 0,(function*(){let t=o;switch(e){case r.DX_SPLASH_GAME_VERSION:t=s}const n=t.map(e=>e-1),a=yield fetch(String.fromCharCode(...n));return yield a.text()}))}},,,function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChartRecordsTable=void 0;const r=a(n(0)),o=n(69),s=n(70);class i extends r.default.PureComponent{render(){const{columns:e,sortBy:t,records:n,songPropsByName:a}=this.props;let{tableClassname:i}=this.props;return i+=" songRecordTable",r.default.createElement("table",{className:i},r.default.createElement("thead",null,r.default.createElement(s.ChartRecordHeadRow,{sortBy:t,columns:e})),r.default.createElement("tbody",null,n.map((t,n)=>(n=t.order||n+1,r.default.createElement(o.ChartRecordDataRow,{songPropsByName:a,record:t,columns:e,index:n})))))}}t.ChartRecordsTable=i},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChartRecordRow=void 0;const r=a(n(0)),o=n(17),s=["orderCell","songTitleCell","difficultyCell","levelCell","achievementCell","rankCell","ratingCell"];class i extends r.default.PureComponent{constructor(){super(...arguments),this.getChildren=(e,t)=>1===t?r.default.createElement("a",{className:"songWikiLink",href:o.getZhWikiLink(e),target:"_blank"},e):"string"==typeof e&&e.includes("\n")?e.split("\n").map((e,t)=>r.default.createElement("div",{key:t},e)):e}render(){const{columnValues:e,isHeading:t,onClickCell:n}=this.props;let a="scoreRecordRow";return this.props.className&&(a+=" "+this.props.className),r.default.createElement("tr",{className:a},e.map((e,a)=>{let o="scoreRecordCell "+s[a];const i=this.getChildren(e,a),l=n?{tabIndex:0,onClick:()=>n(a)}:{};return t?r.default.createElement("th",Object.assign({className:o},l),i):r.default.createElement("td",Object.assign({className:o},l),i)}))}}t.ChartRecordRow=i},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CollapsibleContainer=void 0;const r=a(n(0));class o extends r.default.PureComponent{render(){let e="collapsibleContainer";return this.props.className&&(e+=" "+this.props.className),this.props.hidden&&(e+=" hidden"),r.default.createElement("div",{className:e},this.props.children)}}t.CollapsibleContainer=o},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RankDistributionDataRow=void 0;const r=a(n(0)),o=n(25);t.RankDistributionDataRow=r.default.memo(e=>{const t=[e.rowHead];let n=0;for(const a of e.columns){const r=e.rankDist.get(a);t.push(r||"-"),n+=r}return e.showTotal&&t.push(n),r.default.createElement(o.RankDistributionRow,{values:t,showTotal:e.showTotal,rowClassname:e.rowClassname,baseCellClassname:e.baseCellClassname,perColumnClassnames:e.perColumnClassnames})})},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RankDistributionRow=void 0;const r=a(n(0));class o extends r.default.PureComponent{render(){const{values:e,isHeading:t,showTotal:n,rowClassname:a,baseCellClassname:o,perColumnClassnames:s}=this.props;return r.default.createElement("tr",{className:a},e.map((a,i)=>{const l=t||0===i;let c=o;return s[i]&&(c+=" "+s[i]),n&&i===e.length-1&&(c+=" totalCell"),l?r.default.createElement("th",{className:c},a):r.default.createElement("td",{className:c},a)}))}}t.RankDistributionRow=o},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RankDistributionHeadRow=void 0;const r=a(n(0)),o=n(5),s=n(25);class i extends r.default.PureComponent{render(){const{firstCell:e,columns:t,showTotal:n,baseCellClassname:a,perColumnClassnames:i}=this.props,l=[e];for(const e of t)l.push(e);return n&&l.push(o.UIString.subtotal),r.default.createElement(s.RankDistributionRow,{values:l,isHeading:!0,showTotal:n,baseCellClassname:a,perColumnClassnames:i})}}t.RankDistributionHeadRow=i},,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(n(0)),o=a(n(9)),s=n(1),i=n(54);document.title={zh:"maimai DX R 值分析工具",en:"maimai DX Rating Analyzer"}[s.LANG],o.default.render(r.default.createElement(i.RootComponent),document.getElementById("root"))},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function s(e){try{l(a.next(e))}catch(e){o(e)}}function i(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((a=a.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RootComponent=void 0;const o=r(n(0)),s=n(7),i=n(18),l=n(13),c=n(55),u=n(5),d=n(56),f=n(57),m=n(58),h=n(59),g=n(60),p=n(61),v=n(62),C=n(80),S=n(81);function R(e,t){return new Promise(n=>{if(t.length>0)return void n(l.buildSongPropsMap(t));const a=function(e){switch(e){case s.DX_PLUS_GAME_VERSION:return"dxPlusInnerLv";case s.DX_SPLASH_GAME_VERSION:return"dxSplashInnerLv";default:return"dxInnerLv"}}(e),r=c.readFromCache(a);r?n(l.buildSongPropsMap(r)):(console.log("Magic happening..."),i.iWantSomeMagic(e).then(e=>{c.writeToCache(a,e),n(l.buildSongPropsMap(e))}))})}class y extends o.default.PureComponent{constructor(e){super(e),this.playerGradeIndex=0,this.lvInput=o.default.createRef(),this.scoreInput=o.default.createRef(),this.referrer=document.referrer&&new URL(document.referrer).origin,this.selectVersion=e=>{this.setState({gameVer:e},this.analyzeRating)},this.analyzeRating=e=>a(this,void 0,void 0,(function*(){e&&e.preventDefault();const t=this.lvInput.current?this.lvInput.current.getInput():"",n=this.scoreInput.current?this.scoreInput.current.getInput():"",{gameVer:r}=this.state;console.log("gameVer",r);const o=yield R(r,t);console.log("Song properties:",o);const s=yield function(e){return a(this,void 0,void 0,(function*(){const t=e.split("\n"),n=[];for(const e of t){const t=d.parseScoreLine(e);t&&n.push(t)}return n}))}(n);if(console.log("Player scores:",s),!s.length)return void this.setState({ratingData:void 0,showMultiplierTable:!0});const i=yield f.analyzePlayerRating(o,s,r);console.log("Rating Data:",i),this.setState({ratingData:i,showMultiplierTable:!0,songPropsByName:o})}));const t=new URLSearchParams(document.location.search),n=t.get("gameVersion"),r=n?parseInt(n):s.DX_PLUS_GAME_VERSION;let i="hide"!==t.get("quickLookup");const l=t.get("friendIdx"),c=t.get("playerName");this.state={gameRegion:1,gameVer:r,showMultiplierTable:i,friendIdx:l,playerName:c},window.opener&&this.initWindowCommunication()}componentDidUpdate(e,t){!this.state.songPropsByName||(this.state.oldSongs||this.state.newSongs)&&t.gameVer===this.state.gameVer||this.loadSongLists(this.state.gameVer)}render(){const{gameRegion:e,gameVer:t,showMultiplierTable:n,playerName:a,ratingData:r,songPropsByName:s,oldSongs:i,newSongs:l}=this.state;return o.default.createElement(o.default.Fragment,null,o.default.createElement(S.VersionSelect,{gameVer:t,handleVersionSelect:this.selectVersion}),o.default.createElement(m.InternalLvInput,{ref:this.lvInput}),o.default.createElement(C.ScoreInput,{ref:this.scoreInput}),o.default.createElement("div",{className:"actionArea"},o.default.createElement("button",{className:"analyzeRatingBtn",onClick:this.analyzeRating},u.UIString.computeRating)),o.default.createElement("hr",{className:"sectionSep"}),r&&o.default.createElement(v.RatingOutput,{gameRegion:e,gameVer:t,songPropsByName:s,ratingData:r,playerGradeIndex:this.playerGradeIndex,playerName:a,oldSongs:i,newSongs:l}),n&&o.default.createElement(h.MultiplierTable,null),o.default.createElement(g.OtherTools,null),o.default.createElement(p.PageFooter,null))}postMessageToOpener(e){window.opener&&(this.referrer?window.opener.postMessage(e,this.referrer):(window.opener.postMessage(e,"https://maimaidx-eng.com"),window.opener.postMessage(e,"https://maimaidx.jp")))}initWindowCommunication(){window.addEventListener("message",e=>{var t;if(console.log(e.origin,e.data.action,"string"==typeof(t=e.data.payload)?"string of length "+t.length:t),"https://maimaidx-eng.com"===e.origin||"https://maimaidx.jp"===e.origin){let t;switch(e.data.action){case"gameVersion":t=parseInt(e.data.payload),t>=s.DX_PLUS_GAME_VERSION&&t<=s.DX_SPLASH_GAME_VERSION&&this.setState({gameRegion:"https://maimaidx.jp"===e.origin?1:0,gameVer:t});break;case"playerGrade":t=parseInt(e.data.payload),t&&(this.playerGradeIndex=t);break;case"replacePlayerScore":this.scoreInput.current.setText(e.data.payload);break;case"appendPlayerScore":this.scoreInput.current.appendText(e.data.payload);break;case"calculateRating":this.analyzeRating();break;case"allSongs":this.setState({oldSongs:l.filterSongsByVersion(e.data.payload,this.state.songPropsByName,this.state.gameVer,1)});break;case"newSongs":this.setState({newSongs:l.filterSongsByVersion(e.data.payload,this.state.songPropsByName,this.state.gameVer,0)})}}});const{friendIdx:e}=this.state;e?this.postMessageToOpener({action:"getFriendRecords",payload:e}):this.postMessageToOpener("ready")}loadSongLists(e){this.postMessageToOpener({action:"fetchAllSongs"}),this.postMessageToOpener({action:"fetchNewSongs",payload:e})}}t.RootComponent=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeToCache=t.readFromCache=void 0;t.readFromCache=function(e){const t=window.localStorage.getItem(e);if(console.log('Reading cache for "'+e+'" =>',t),!t)return null;const n=JSON.parse(t),a=new Date(n.date);return(new Date).valueOf()-a.valueOf()>864e5?(console.warn('Cache for "'+e+'" is expired.'),window.localStorage.removeItem(e),null):n.content},t.writeToCache=function(e,t){console.log('Updating cache for "'+e+'"');const n={date:new Date,content:t};window.localStorage.setItem(e,JSON.stringify(n))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseScoreLine=void 0;const a=n(7),r=n(11),o=n(8);t.parseScoreLine=function(e){const[t,n,s,i,l,c]=e.split("\t");if(t&&n&&s&&i&&l&&c){const e=parseFloat(c),u=function(e){e=Math.min(e,a.SSSPLUS_MIN_ACHIEVEMENT);const t=o.getRankByAchievement(e);t||console.warn(`Could not find rank for achievement ${e.toFixed(4)}%`);const n=t?t.factor:5;return{factor:n,multiplier:n*e/100}}(e);return{songName:t,genre:n,difficulty:s,level:r.getDefaultLevel(i),levelIsEstimate:!0,chartType:"DX"===l?1:0,achievement:e,multiplier:u.multiplier,rankFactor:u.factor}}}},function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function s(e){try{l(a.next(e))}catch(e){o(e)}}function i(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.analyzePlayerRating=t.analyzeSongRating=void 0;const r=n(7),o=n(13),s=n(14);function i(e,t){if(t){const n=r.DIFFICULTIES.indexOf(e.difficulty),a=t.lv[n];"number"==typeof a&&(e.levelIsEstimate=a<0,e.level=Math.abs(a))}return Object.assign(Object.assign({},e),{rating:e.level*e.multiplier})}t.analyzeSongRating=i,t.analyzePlayerRating=function(e,t,n){return a(this,void 0,void 0,(function*(){const a=[],r=[];for(const s of t){const t=o.getSongProperties(e,s.songName,s.genre,s.chartType),l=t?t.debut===n:1===s.chartType,c=i(s,t);l?a.push(c):r.push(c)}a.sort(s.compareSongsByRating),r.sort(s.compareSongsByRating);let l=0;const c=Math.min(15,a.length);for(let e=0;e<c;e++)l+=Math.floor(a[e].rating);let u=0;const d=Math.min(25,r.length);for(let e=0;e<d;e++)u+=Math.floor(r[e].rating);return{newChartRecords:a,newChartsRating:l,newTopChartsCount:c,oldChartRecords:r,oldChartsRating:u,oldTopChartsCount:d}}))}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InternalLvInput=void 0;const r=a(n(0)),o=n(5);class s extends r.default.PureComponent{constructor(){super(...arguments),this.state={showTextarea:!1},this.textareaRef=r.default.createRef(),this.handleRadioChange=e=>{this.setState({showTextarea:"1"===e.currentTarget.value})}}render(){const{showTextarea:e}=this.state;return r.default.createElement("div",{className:"w90"},r.default.createElement("h2",{className:"lvInputHeading"},o.UIString.internalLvHeading),r.default.createElement("form",null,r.default.createElement("label",{className:"radioLabel"},r.default.createElement("input",{className:"radioInput",name:"showLvInput",value:"0",type:"radio",checked:!e,onChange:this.handleRadioChange}),o.UIString.autoLv),r.default.createElement("label",{className:"radioLabel"},r.default.createElement("input",{className:"radioInput",name:"showLvInput",value:"1",type:"radio",checked:e,onChange:this.handleRadioChange}),o.UIString.manualLv)),e&&r.default.createElement("textarea",{className:"lvInput",ref:this.textareaRef}))}getInput(){return this.textareaRef.current?this.textareaRef.current.value:""}}t.InternalLvInput=s},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MultiplierTable=void 0;const r=a(n(0)),o=n(8),s=n(5),i=["qlRankTitleCell","qlThresholdCell"],l=e=>{const{isHeading:t}=e;return r.default.createElement("tr",null,e.values.map((e,n)=>{let a="qlRankFactorCell";return n<i.length&&(a+=" "+i[n]),t||0===n?r.default.createElement("th",{className:a},e):r.default.createElement("td",{className:a},e)}))};class c extends r.default.PureComponent{constructor(){super(...arguments),this.state={minRankOption:"A"}}render(){const{minRankOption:e}=this.state,t=o.RANK_DEFINITIONS,n=t.findIndex(t=>t.title===e)+1;return r.default.createElement("div",{className:"quickLookup"},r.default.createElement("h2",{className:"quickLookupHeading"},s.UIString.rankFactorTable),r.default.createElement("table",{className:"quickLookupTable"},r.default.createElement("thead",null,r.default.createElement(l,{values:[s.UIString.rank,s.UIString.achievement,s.UIString.factor,s.UIString.multiplier],isHeading:!0})),r.default.createElement("tbody",null,t.slice(0,n).map((e,t,n)=>{const a=e.th*e.factor/100,o=t>0?(n[t-1].th-1e-4)*e.factor/100:a,s=a.toFixed(3),i=o.toFixed(3),c=s!==i?`${s} - ${i}`:s;return r.default.createElement(l,{values:[e.title,e.th,e.factor,c]})}))),r.default.createElement("hr",{className:"sectionSep"}))}}t.MultiplierTable=c},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OtherTools=void 0;const r=a(n(0)),o=n(5);class s extends r.default.PureComponent{render(){return r.default.createElement("div",{className:"otherToolsContainer"},r.default.createElement("h2",{className:"otherToolsHeading"},o.UIString.otherToolsHeading),r.default.createElement("ul",null,r.default.createElement("li",{className:"toolItem"},r.default.createElement("a",{href:"../rating-visualizer/",target:"_blank"},o.UIString.ratingVisualizer)),r.default.createElement("li",{className:"toolItem"},r.default.createElement("a",{href:"../bookmarklets/",target:"_blank"},o.UIString.bookmarketList))),r.default.createElement("hr",{className:"sectionSep"}))}}t.OtherTools=s},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageFooter=void 0;const r=a(n(0));class o extends r.default.PureComponent{render(){return r.default.createElement("footer",null,"Made by"," ",r.default.createElement("a",{className:"authorLink",href:"https://github.com/myjian/"},"myjian"),".")}}t.PageFooter=o},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RatingOutput=void 0;const r=a(n(0)),o=n(63),s=n(5),i=n(66),l=n(76),c=n(78);class u extends r.default.PureComponent{constructor(){super(...arguments),this.outputArea=r.default.createRef()}componentDidMount(){this.outputArea.current&&this.outputArea.current.scrollIntoView({behavior:"smooth"})}render(){const{gameRegion:e,gameVer:t,playerName:n,playerGradeIndex:a,songPropsByName:o}=this.props,{newChartsRating:u,newTopChartsCount:d,oldChartsRating:f,oldTopChartsCount:m}=this.props.ratingData,{newCandidateCharts:h,oldCandidateCharts:g,notPlayedNewCharts:p,notPlayedOldCharts:v}=this.state;return r.default.createElement("div",{className:"outputArea",ref:this.outputArea},r.default.createElement("h2",{id:"outputHeading"},s.UIString.analysisResult,n?" - "+n:null),r.default.createElement(l.RatingOverview,{newChartsRating:u,newTopChartsCount:d,oldChartsRating:f,oldTopChartsCount:m,playerGradeIndex:a}),r.default.createElement(c.RecommendedLevels,{gameRegion:e,gameVer:t,newChartsRating:u,newTopChartsCount:d,oldChartsRating:f,oldTopChartsCount:m}),r.default.createElement(i.RatingDetails,{songPropsByName:o,newCandidateCharts:h,oldCandidateCharts:g,notPlayedNewCharts:p,notPlayedOldCharts:v,ratingData:this.props.ratingData}),r.default.createElement("hr",{className:"sectionSep"}))}}t.RatingOutput=u,u.getDerivedStateFromProps=e=>{const{newSongs:t,oldSongs:n,ratingData:a}=e,{newChartRecords:r,newTopChartsCount:s,oldChartRecords:i,oldTopChartsCount:l}=a,c=o.getCandidateCharts(r,s,100),u=t?o.getNotPlayedCharts(t,r,s,100):[];console.log(u);const d=o.getCandidateCharts(i,l,250),f=n?o.getNotPlayedCharts(n,i,l,250):[];return console.log(f),{newCandidateCharts:c,oldCandidateCharts:d,notPlayedNewCharts:u,notPlayedOldCharts:f}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNotPlayedCharts=t.getCandidateCharts=void 0;const a=n(64),r=n(7),o=n(8),s=n(4),i=n(65),l=n(14);function c(e,t,n){let a=o.getRankIndexByAchievement(e.achievement);-1===a&&(a=o.getRankIndexByAchievement(94));const r=new Map;for(let s=a-1;s>=0;s--){const a=o.RANK_DEFINITIONS[s];if(a.title===o.RANK_DEFINITIONS[s+1].title)continue;const[l]=i.calculateRatingRange(e.level,a);if(l>t&&(r.set(a.title,{minRt:l-t,rank:a}),r.size>=n))break}return r}t.getCandidateCharts=function(e,t,n){const a=[];if(t<=0)return a;for(let n=0;n<t;n++){const t=e[n];if(t.achievement<r.SSSPLUS_MIN_ACHIEVEMENT){const e=c(t,Math.floor(t.rating),2);if(!e.size)continue;t.nextRanks=e,a.push(t)}}const o=Math.floor(e[t-1].rating);for(let s=t;s<e.length;s++){const t=e[s];if(t.achievement<r.SSSPLUS_MIN_ACHIEVEMENT){const e=c(t,o,2);if(!e.size)continue;if(t.nextRanks=e,a.push(t),a.length>=n)break}}return a.sort(l.compareCandidate),a},t.getNotPlayedCharts=function(e,t,n,i){const u=new Set;for(const e of t){const t=s.getSongNickname(e.songName,e.genre,1===e.chartType);u.add(t+e.difficulty)}const d=t.length?Math.ceil(t[0].rating):0,f=t.length?Math.floor(t[n-1].rating):0,m=o.getRankByAchievement(100.5),h=o.getRankByAchievement(97),g=d?100*d/(h.factor*h.th):15,p=100*f/(m.factor*m.th),v=[],C=a.shuffleArray(e);console.log(`rating range is ${f} - ${d}`),console.log(`lv limited to ${p} - ${g}`);for(const e of C){for(let t=1;t<e.lv.length;t++){let n=e.lv[t];const a=n<0;n=Math.abs(n);const o="Link"===e.name?e.nickname:s.getSongNickname(e.name,"",1===e.dx),i=r.DIFFICULTIES[Math.min(t,r.DIFFICULTIES.length-1)];if(u.has(o+i)||n<p||n>g)continue;const l={songName:e.name,difficulty:i,level:n,levelIsEstimate:a,genre:"",chartType:e.dx,rankFactor:0,rating:0,achievement:0,multiplier:0},d=c(l,f,1);d.size&&(l.nextRanks=d,v.push(l))}if(v.length>=i)break}return v.sort(l.compareSongsByLevel),v}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shuffleArray=void 0,t.shuffleArray=function(e){const t=e.slice(),n=t.length;for(let e=0;e<n;e++){const a=t[e],r=Math.floor(Math.random()*n);t[e]=t[r],t[r]=a}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateRatingRange=void 0;const a=n(8);t.calculateRatingRange=function(e,t){const n=a.RANK_DEFINITIONS,r=n.indexOf(t),o=r>=1?n[r-1].th-1e-4:t.th;return[Math.floor(e*t.th*t.factor/100),Math.floor(e*o*t.factor/100)]}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RatingDetails=void 0;const r=a(n(0)),o=n(5),s=n(67),i=n(71),l=n(72);class c extends r.default.PureComponent{constructor(){super(...arguments),this.outputArea=r.default.createRef(),this.state={hideNewTopSongs:!1,hideOldTopSongs:!1,hideNewCandidates:!1,hideOldCandidates:!1},this.toggleNewTopChartsDisplay=()=>{this.setState(e=>({hideNewTopSongs:!e.hideNewTopSongs}))},this.toggleNewCandidateChartsDisplay=()=>{this.setState(e=>({hideNewCandidates:!e.hideNewCandidates}))},this.toggleOldTopChartsDisplay=()=>{this.setState(e=>({hideOldTopSongs:!e.hideOldTopSongs}))},this.toggleOldCandidateChartsDisplay=()=>{this.setState(e=>({hideOldCandidates:!e.hideOldCandidates}))}}componentDidMount(){this.outputArea.current&&this.outputArea.current.scrollIntoView({behavior:"smooth"})}render(){const{newCandidateCharts:e,notPlayedNewCharts:t,oldCandidateCharts:n,notPlayedOldCharts:a,songPropsByName:c}=this.props,{newChartRecords:u,newTopChartsCount:d,oldChartRecords:f,oldTopChartsCount:m}=this.props.ratingData,{hideNewCandidates:h,hideNewTopSongs:g,hideOldCandidates:p,hideOldTopSongs:v}=this.state;return r.default.createElement(r.default.Fragment,null,r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement(i.ChartRecordSectionTitle,{title:o.UIString.newChartsRatingTargets,contentHidden:g,onClick:this.toggleNewTopChartsDisplay}),r.default.createElement(l.TopChartRecords,{songPropsByName:c,records:u,limit:d,hidden:g})),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement(i.ChartRecordSectionTitle,{title:o.UIString.oldChartsRatingTargets,contentHidden:v,onClick:this.toggleOldTopChartsDisplay}),r.default.createElement(l.TopChartRecords,{songPropsByName:c,records:f,limit:m,hidden:v})),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement(i.ChartRecordSectionTitle,{title:o.UIString.newChartsRatingCandidates,contentHidden:h,onClick:this.toggleNewCandidateChartsDisplay,isCandidateList:!0}),r.default.createElement(s.CandidateChartRecords,{name:"new",songPropsByName:c,records:e,hidden:h,notPlayed:t})),r.default.createElement("div",{className:"songRecordsContainer"},r.default.createElement(i.ChartRecordSectionTitle,{title:o.UIString.oldChartsRatingCandidates,contentHidden:p,onClick:this.toggleOldCandidateChartsDisplay,isCandidateList:!0}),r.default.createElement(s.CandidateChartRecords,{name:"old",songPropsByName:c,records:n,hidden:p,notPlayed:a})))}}t.RatingDetails=c},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CandidateChartRecords=void 0;const r=a(n(0)),o=n(5),s=n(14),i=n(68),l=n(21),c=n(23),u=[0,1,2,3,4,6,8],d=new Map([[1,s.compareSongsByName],[2,s.compareSongsByDifficulty],[3,s.compareSongsByLevel],[4,s.compareSongsByAchv],[6,s.compareSongsByNextRank],[8,s.compareSongsByNextRating]]);class f extends r.default.PureComponent{constructor(){super(...arguments),this.state={showAll:!1,showPlayed:!0},this.toggleShowMore=e=>{e.preventDefault(),this.setState(e=>({showAll:!e.showAll}))},this.toggleShowNotPlayed=e=>{this.setState({showPlayed:e})},this.handleSortBy=e=>{this.setState(t=>{d.has(e)?e===t.sortBy?this.setState({reverse:!t.reverse}):this.setState({sortBy:e,reverse:!1}):this.setState({sortBy:void 0})})}}render(){const{hidden:e,records:t,notPlayed:n,songPropsByName:a,name:s}=this.props,{showAll:f,showPlayed:m,sortBy:h,reverse:g}=this.state;let p=m?t.slice():n.slice();const v=p.length>20;return v&&!f&&(p=p.slice(0,20)),p.forEach((e,t)=>e.order=t+1),h&&(p.sort(d.get(h)),g&&p.reverse()),r.default.createElement(c.CollapsibleContainer,{className:"songRecordTableContainer",hidden:e},n&&r.default.createElement(i.CandidatesPlayedToggle,{name:s,showPlayed:m,toggleShowPlayed:this.toggleShowNotPlayed}),r.default.createElement(l.ChartRecordsTable,{songPropsByName:a,tableClassname:"candidateTable",records:p,sortBy:this.handleSortBy,columns:u}),v&&r.default.createElement("a",{className:"showMore",href:"#",onClick:this.toggleShowMore},f?o.UIString.showLess:o.UIString.showMore))}}t.CandidateChartRecords=f},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CandidatesPlayedToggle=void 0;const r=a(n(0)),o=n(5);class s extends r.default.PureComponent{constructor(){super(...arguments),this.handleRadioChange=()=>{this.props.toggleShowPlayed(!this.props.showPlayed)}}render(){const{name:e,showPlayed:t}=this.props;return r.default.createElement("div",{className:"w90"},r.default.createElement("form",{className:"playedToggleForm"},r.default.createElement("label",{className:"radioLabel"},r.default.createElement("input",{className:"radioInput",name:"showPlayed-"+e,value:"1",type:"radio",checked:t,onChange:this.handleRadioChange}),o.UIString.showPlayed),r.default.createElement("label",{className:"radioLabel"},r.default.createElement("input",{className:"radioInput",name:"showPlayed-"+e,value:"0",type:"radio",checked:!t,onChange:this.handleRadioChange}),o.UIString.showNotPlayed)))}}t.CandidatesPlayedToggle=s},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChartRecordDataRow=void 0;const r=a(n(0)),o=n(7),s=n(8),i=n(4),l=n(22);t.ChartRecordDataRow=r.default.memo(e=>{const{record:t,index:n,columns:a,songPropsByName:c}=e,u=a.map(e=>{switch(e){case 0:return n;case 1:return function(e,t){const n=t.get(e.songName);return n&&n.length>1?i.getSongNickname(e.songName,e.genre,1===e.chartType):e.songName}(t,c);case 2:return t.difficulty;case 3:const e=t.level.toFixed(1);return t.levelIsEstimate?"*"+e:e;case 4:return t.achievement.toFixed(4)+"%";case 5:return s.getRankTitle(t.achievement);case 6:return Array.from(t.nextRanks.values()).map(e=>e.rank.th+"%").join("\n");case 8:return Array.from(t.nextRanks.values()).map(e=>"+"+e.minRt.toFixed(0)).join("\n");case 7:return Math.floor(t.rating).toString()}});return r.default.createElement(l.ChartRecordRow,{className:o.DIFFICULTY_CLASSNAME_MAP.get(t.difficulty),columnValues:u})})},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChartRecordHeadRow=void 0;const r=a(n(0)),o=n(5),s=n(22),i={0:o.UIString.num,1:o.UIString.song,2:o.UIString.difficulty,3:o.UIString.level,4:o.UIString.achievementAbbr,5:o.UIString.rank,7:o.UIString.rating,6:o.UIString.nextGoal,8:o.UIString.nextRating};t.ChartRecordHeadRow=r.default.memo(({columns:e,sortBy:t})=>{const n=e.map(e=>i[e]),a=t&&(n=>t(e[n]));return r.default.createElement(s.ChartRecordRow,{columnValues:n,onClickCell:a,isHeading:!0})})},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChartRecordSectionTitle=void 0;const r=a(n(0));class o extends r.default.PureComponent{constructor(){super(...arguments),this.state={symbolClassName:""},this.handleClick=e=>{e.preventDefault(),this.props.onClick(e)},this.handleKeyPress=e=>{e.preventDefault(),console.log(e.key),console.log(e.keyCode),"Enter"===e.key&&this.props.onClick(e)}}componentDidUpdate(e){e.contentHidden&&!this.props.contentHidden&&(this.setState({symbolClassName:"crSecShow"}),window.setTimeout(()=>{this.setState({symbolClassName:""})},300))}render(){const{isCandidateList:e,contentHidden:t,title:n}=this.props;let{symbolClassName:a}=this.state;const o=e?"▶":"▷";return a+=" crSecTitleSymbol",t&&(a+=" crSecHidden"),r.default.createElement("h3",{className:"crSecTitleContainer"},r.default.createElement("span",{className:"crSecTitle",tabIndex:0,onClick:this.handleClick,onKeyPress:this.handleKeyPress},r.default.createElement("span",{className:a},o),n))}}t.ChartRecordSectionTitle=o},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TopChartRecords=void 0;const r=a(n(0)),o=n(5),s=n(14),i=n(21),l=n(23),c=n(73),u=n(74),d=[0,1,2,3,4,5,7],f=new Map([[1,s.compareSongsByName],[2,s.compareSongsByDifficulty],[3,s.compareSongsByLevel],[4,s.compareSongsByAchv],[5,s.compareSongsByAchv],[7,s.compareSongsByRating]]);class m extends r.default.PureComponent{constructor(){super(...arguments),this.state={sortBy:7},this.handleSortBy=e=>{this.setState(t=>{f.has(e)?e===t.sortBy?this.setState({reverse:!t.reverse}):this.setState({sortBy:e,reverse:!1}):this.setState({sortBy:void 0})})}}render(){const{hidden:e,records:t,limit:n,songPropsByName:a}=this.props,{sortBy:s,reverse:m}=this.state;let h=t.slice(0,n);return h.forEach((e,t)=>e.order=t+1),s&&(h.sort(f.get(s)),m&&h.reverse()),r.default.createElement(l.CollapsibleContainer,{className:"songRecordTableContainer",hidden:e},r.default.createElement("div",{className:"responsiveFlexBox"},r.default.createElement(u.LevelRankDistribution,{topLeftCell:o.UIString.level,chartRecords:h,topChartsCount:n}),r.default.createElement(c.DifficultyDistribution,{chartRecords:h,topChartsCount:n})),r.default.createElement(i.ChartRecordsTable,{songPropsByName:a,columns:d,tableClassname:"topRecordTable",records:h,sortBy:this.handleSortBy}))}}t.TopChartRecords=m},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DifficultyDistribution=void 0;const r=a(n(0)),o=n(7),s=n(5),i=n(24),l=n(26);class c extends r.default.PureComponent{render(){const{chartRecords:e,topChartsCount:t}=this.props,n=function(e){const t=new Map;for(let e=o.DIFFICULTIES.length-1;e>=0;e--)t.set(o.DIFFICULTIES[e],[]);for(const n of e)t.get(n.difficulty).push(n);return t}(e.slice(0,t)),a=new Map([[s.UIString.subtotal,!0]]);return r.default.createElement("table",{className:"rankDistributionTable"},r.default.createElement("thead",null,r.default.createElement(l.RankDistributionHeadRow,{firstCell:s.UIString.difficulty,baseCellClassname:"diffRankCell",perColumnClassnames:["difficultyRankDistHead"],columns:a.keys()})),r.default.createElement("tbody",null,Array.from(n.entries()).map(([e,t])=>{if(!t.length)return;const n=new Map([[s.UIString.subtotal,t.length]]);return r.default.createElement(i.RankDistributionDataRow,{key:e,rowHead:e,columns:a.keys(),rankDist:n,rowClassname:o.DIFFICULTY_CLASSNAME_MAP.get(e),baseCellClassname:"diffRankCell",perColumnClassnames:[]})})))}}t.DifficultyDistribution=c},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LevelRankDistribution=void 0;const r=a(n(0)),o=n(11),s=n(10),i=n(75),l=n(24),c=n(26),u=["officialLevelCell"];class d extends r.default.PureComponent{render(){const{chartRecords:e,topLeftCell:t,topChartsCount:n}=this.props,a=e.slice(0,n),d=i.getRankMap(a),f=function(e){const t=e.map(e=>e.level);t.sort(s.compareNumber),t.reverse();const n=new Map;for(const e of t){const t=o.getOfficialLevel(e);n.has(t)||n.set(t,[])}for(const t of e)n.get(o.getOfficialLevel(t.level)).push(t);return n}(a);return r.default.createElement("table",{className:"rankDistributionTable"},r.default.createElement("thead",null,r.default.createElement(c.RankDistributionHeadRow,{columns:d.keys(),firstCell:t,baseCellClassname:"levelRankCell",perColumnClassnames:u})),r.default.createElement("tbody",null,Array.from(f.entries()).map(([e,t])=>r.default.createElement(l.RankDistributionDataRow,{key:e,rowHead:e,columns:d.keys(),rankDist:i.getRankDistribution(t),baseCellClassname:"levelRankCell",perColumnClassnames:u}))))}}t.LevelRankDistribution=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRankMap=t.getRankDistribution=void 0;const a=n(8);function r(e){const t=new Map;for(const e of a.RANK_DEFINITIONS)t.set(e.title,0);return e.forEach(e=>{const n=a.getRankTitle(e.achievement),r=t.get(n);t.set(n,r+1)}),t}t.getRankDistribution=r,t.getRankMap=function(e){const t=r(e),n=new Map;let a=e.length;for(const[e,r]of t)a>0&&n.set(e,!0),a-=r;return n}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RatingOverview=void 0;const r=a(n(0)),o=n(77),s=n(5);class i extends r.default.PureComponent{render(){const{oldChartsRating:e,oldTopChartsCount:t,newChartsRating:n,newTopChartsCount:a,playerGradeIndex:i}=this.props;let l=n+e;const c=i>0?o.getGradeByIndex(i):null;return c&&(l+=c.bonus),r.default.createElement("div",{className:"ratingOverview"},r.default.createElement("div",{className:"totalRatingRow"},"Rating： ",r.default.createElement("span",null,l)),r.default.createElement("table",{className:"ratingOverviewTable"},r.default.createElement("tbody",null,r.default.createElement("tr",null,r.default.createElement("td",null,s.UIString.newChartsRating),r.default.createElement("td",{className:"columnColumn"},s.UIString.column),r.default.createElement("td",{className:"subRatingColumn"},n),r.default.createElement("td",{className:"avgRatingColumn"},"(",s.UIString.average,s.UIString.column," ",this.getAvg(n,a),")")),r.default.createElement("tr",null,r.default.createElement("td",null,s.UIString.oldChartsRating),r.default.createElement("td",null,s.UIString.column),r.default.createElement("td",{className:"subRatingColumn"},e),r.default.createElement("td",{className:"avgRatingColumn"},"(",s.UIString.average,s.UIString.column," ",this.getAvg(e,t),")")),c&&r.default.createElement("tr",null,r.default.createElement("td",null,s.UIString.grade," (",r.default.createElement("span",null,c.title),")"),r.default.createElement("td",null,s.UIString.column),r.default.createElement("td",{className:"subRatingColumn"},c.bonus)))))}getAvg(e,t){return t?(e/t).toFixed(0):0}}t.RatingOverview=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGradeByIndex=void 0;const a=[{title:"",bonus:0},{title:"初心者",bonus:0},{title:"見習い",bonus:250},{title:"駆け出し",bonus:500},{title:"修行中",bonus:750},{title:"初段",bonus:1e3},{title:"二段",bonus:1200},{title:"三段",bonus:1400},{title:"四段",bonus:1500},{title:"五段",bonus:1600},{title:"六段",bonus:1700},{title:"七段",bonus:1800},{title:"八段",bonus:1850},{title:"九段",bonus:1900},{title:"十段",bonus:1950},{title:"皆伝",bonus:2e3},{title:"壱皆伝",bonus:2010},{title:"弐皆伝",bonus:2020},{title:"参皆伝",bonus:2030},{title:"肆皆伝",bonus:2040},{title:"伍皆伝",bonus:2050},{title:"陸皆伝",bonus:2060},{title:"漆皆伝",bonus:2070},{title:"捌皆伝",bonus:2080},{title:"玖皆伝",bonus:2090},{title:"拾皆伝",bonus:2100}];t.getGradeByIndex=function(e){return a[e]}},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RecommendedLevels=void 0;const r=a(n(0)),o=n(10),s=n(8),i=n(5),l=n(79);class c extends r.default.PureComponent{render(){const{gameRegion:e,gameVer:t,newChartsRating:n,newTopChartsCount:a,oldChartsRating:o,oldTopChartsCount:c}=this.props;let u=s.RANK_DEFINITIONS;const d=u.findIndex(e=>"SS"===e.title);u=u.slice(0,d+1).filter((e,t,n)=>t===n.length-1||e.title!==n[t+1].title);const f=a>0?Math.floor(n/a):0,m=c>0?Math.floor(o/c):0,h=u.map(e=>{const t=this.calcRecommendedLv(f,e);return t>15?-1:t}),g=u.map(e=>{const t=this.calcRecommendedLv(m,e);return t>15?-1:t});return r.default.createElement("div",{className:"recLvSection"},r.default.createElement("h3",{className:"recLvTitle"},i.UIString.recommendedLevels),r.default.createElement("p",{className:"recLvDesc"},i.UIString.levelComment),r.default.createElement("table",{className:"recLvTable"},r.default.createElement("thead",null,r.default.createElement("tr",null,r.default.createElement("th",{className:"recLvFirstCol"}),u.map(e=>r.default.createElement("th",null,r.default.createElement("span",{className:"recLvRankTitle"},e.title),r.default.createElement("span",{className:"recLvRankAchv"},e.th,"%"))),r.default.createElement("th",null,i.UIString.projectedRating))),r.default.createElement("tbody",null,f>0&&r.default.createElement("tr",null,r.default.createElement("th",{className:"recLvFirstCol"},i.UIString.newChartsRecLv),h.map(n=>r.default.createElement(l.RecommendedLevelCell,{gameRegion:e,gameVer:t,lv:n})),r.default.createElement("td",null,Math.floor(f),"↑")),m>0&&r.default.createElement("tr",null,r.default.createElement("th",{className:"recLvFirstCol"},i.UIString.oldChartsRecLv),g.map(n=>r.default.createElement(l.RecommendedLevelCell,{gameRegion:e,gameVer:t-1,includeOldVersions:!0,lv:n})),r.default.createElement("td",null,Math.floor(m),"↑")))))}calcRecommendedLv(e,t){return o.roundFloat(e/t.factor/t.th*100,"ceil",.1)}}t.RecommendedLevels=c},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RecommendedLevelCell=void 0;const r=a(n(0)),o=n(11),s=["maimai","maimai PLUS","GreeN","GreeN PLUS","ORANGE","ORANGE PLUS","PiNK","PiNK PLUS","MURASAKi","MURASAKi PLUS","MiLK","MiLK PLUS","FiNALE","でらっくす","でらっくす PLUS","Splash","Splash PLUS"];function i(e,t,n,a){e=e.replace("+",".5");const r=new URLSearchParams;r.set("maxLevelValue",e),r.set("minLevelValue",e),0===t&&r.set("region","intl");const o=[];for(;n<=a;)o.push(s[n]),n++;return r.set("versions",o.join("|")),"https://maimai-songs.zetaraku.dev/?"+r}class l extends r.default.PureComponent{render(){const{gameRegion:e,gameVer:t,lv:n,includeOldVersions:a}=this.props;if(n<0)return r.default.createElement("td",null,"--");const s=o.getOfficialLevel(n);return r.default.createElement("td",null,r.default.createElement("a",{href:i(s,e,a?0:t,t),target:"_blank"},s),r.default.createElement("br",null),"(",n.toFixed(1),"~)")}}t.RecommendedLevelCell=l},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScoreInput=void 0;const r=a(n(0)),o=n(5);class s extends r.default.PureComponent{constructor(){super(...arguments),this.textareaRef=r.default.createRef()}render(){return r.default.createElement("div",{className:"w90"},r.default.createElement("h2",{className:"scoreInputHeading"},o.UIString.scoreInputHeading),r.default.createElement("div",null,o.UIString.scoreInputDescPrefix,r.default.createElement("a",{href:"/mai-tools/bookmarklets/",target:"_blank"},o.UIString.bookmarketLinkLabel),o.UIString.scoreInputDescSuffix),r.default.createElement("textarea",{className:"scoreInputArea",ref:this.textareaRef}))}getInput(){return this.textareaRef.current?this.textareaRef.current.value:""}setText(e){this.textareaRef.current&&(this.textareaRef.current.value=e)}appendText(e){this.textareaRef.current&&(this.textareaRef.current.value+=e+"\n")}}t.ScoreInput=s},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VersionSelect=void 0;const r=a(n(0)),o=n(5);class s extends r.default.PureComponent{constructor(){super(...arguments),this.handleChange=e=>{this.props.handleVersionSelect(parseInt(e.currentTarget.value))}}render(){const{gameVer:e}=this.props,t=e.toFixed(0);return r.default.createElement("label",null,o.UIString.gameVer,r.default.createElement("select",{className:"gameVersion",onChange:this.handleChange},r.default.createElement("option",{value:"14",selected:"14"===t},"DX Plus"),r.default.createElement("option",{value:"15",selected:"15"===t},"DX Splash")))}}t.VersionSelect=s}]);